<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¥¿å¯§è²“å’ªå–®å­—å¤§æˆ°çˆ­ - è¥¿å¯§è‹±é›„æ¦œ (V4)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Roboto+Mono:wght@500&display=swap');

        :root {
            --bg-sky: #A0D8EF;
            --bg-ground: #E0E0E0;
            --ui-panel: #222;
            --cat-color: #fff;
            --dog-color: #DDAA77;
            --base-hp: #4CAF50;
            --enemy-hp: #F44336;
            --money-color: #FFD700;
            --score-color: #00E676;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-sky);
            touch-action: none;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Battle Area (Top 55%) */
        #canvas-container {
            flex: 5.5;
            position: relative;
            background: linear-gradient(to bottom, #87CEEB 70%, #dcdcdc 70%);
            overflow: hidden;
            border-bottom: 2px solid #000;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }

        .hud-left-group {
            display: flex;
            flex-direction: column;
            width: 30%;
        }

        #level-indicator {
            color: #fff;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 5px;
            background: rgba(0,0,0,0.5);
            padding: 2px 8px;
            border-radius: 5px;
            align-self: flex-start;
        }

        .hp-bar-container {
            width: 100%;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #fff;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .hp-bar-container.right {
            width: 30%;
        }

        .hp-bar {
            height: 100%;
            width: 100%;
            transition: width 0.2s;
        }

        #player-hp { background-color: var(--base-hp); }
        #enemy-hp { background-color: var(--enemy-hp); }
        
        #money-display {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: var(--money-color);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid #fff;
            text-shadow: 1px 1px 0 #000;
        }

        #score-display {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--score-color);
            background: rgba(0,0,0,0.8);
            padding: 5px 20px;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            border: 2px solid #fff;
            text-shadow: 1px 1px 0 #000;
            z-index: 11;
        }
        
        #shield-indicator {
            position: absolute;
            top: 100px;
            right: 10px;
            color: cyan;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 5px blue;
            display: none;
            animation: pulse 1s infinite;
        }
        
        #words-remaining {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0,0,0,0.4);
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* ç§»é™¤èˆŠçš„ base-iconï¼Œæ”¹ç”¨ Canvas ç¹ªè£½ */
        .base-icon {
            display: none;
        }

        /* Unit Production Bar (Middle 15%) */
        #unit-bar {
            flex: 1.5;
            background: #444;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 5px;
            box-shadow: inset 0 0 10px #000;
        }

        .unit-btn {
            position: relative;
            width: 70px;
            height: 70px;
            background: #eee;
            border: 3px solid #888;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }

        .unit-btn:active { transform: scale(0.95); }
        
        .unit-btn.disabled {
            filter: grayscale(100%) brightness(50%);
            cursor: not-allowed;
            border-color: #444;
        }

        .unit-btn.cooldown::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            border-radius: 8px;
            animation: sweep var(--cd) linear forwards;
            transform-origin: bottom;
        }

        @keyframes sweep {
            0% { height: 100%; }
            100% { height: 0%; }
        }

        .unit-icon { font-size: 24px; }
        .unit-cost { font-size: 12px; font-weight: bold; color: #333; margin-top: 2px;}
        .key-hint { 
            position: absolute; 
            top: 2px; left: 4px; 
            font-size: 10px; 
            color: #555; 
            font-weight: bold;
            border: 1px solid #999;
            padding: 0 3px;
            border-radius: 3px;
        }

        /* Control Panel (Bottom 30%) */
        #control-panel {
            flex: 3;
            background-color: var(--ui-panel);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            color: white;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.5);
            z-index: 20;
        }

        #word-info {
            text-align: center;
            margin-bottom: 10px;
            position: relative;
        }

        .chinese-hint {
            color: #FFD700;
            font-weight: bold;
            display: block;
            font-size: 1.6rem;
            margin-bottom: 5px;
        }

        .english-hint {
            color: #A0D8EF;
            margin-left: 15px;
            font-family: 'Roboto Mono', monospace;
        }
        
        #target-word-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.4rem;
            color: #aaa;
            letter-spacing: 2px;
            min-height: 1.6rem;
            display: inline-block;
        }

        /* Speaker Button */
        #speaker-btn {
            display: inline-block;
            margin-left: 10px;
            background: none;
            border: 2px solid #666;
            color: #aaa;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            vertical-align: middle;
            font-size: 16px;
            line-height: 26px;
            transition: all 0.2s;
        }
        #speaker-btn:hover { background: #444; color: #fff; border-color: #fff; }
        #speaker-btn:active { transform: scale(0.9); }
        #speaker-btn.speaking { color: #00E676; border-color: #00E676; animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .char-correct { color: #00E676; }
        .char-pending { color: #666; }
        
        .reward-preview {
            font-size: 0.9rem;
            color: #00E676;
            display: block;
            margin-top: 5px;
        }

        #input-area {
            display: flex;
            width: 90%;
            max-width: 500px;
            gap: 10px;
            position: relative;
        }

        #answer-input {
            flex: 1;
            padding: 10px;
            font-size: 1.2rem;
            border: 3px solid #666;
            border-radius: 8px;
            background: #222;
            color: white;
            font-family: 'Roboto Mono', monospace;
            text-transform: capitalize;
            text-align: center;
        }
        
        #answer-input:focus {
            outline: none;
            border-color: #FFD700;
        }
        
        #answer-input.locked {
            pointer-events: none;
        }
        
        #answer-input.shake {
            animation: shake 0.3s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Screens */
        .overlay-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
        }

        .overlay-screen h1 { font-size: 2.5rem; margin-bottom: 10px; color: #FFD700; }
        .overlay-screen p { font-size: 1.1rem; max-width: 600px; line-height: 1.5; margin-bottom: 20px; color: #ccc;}
        
        .start-btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: #e91e63;
            color: white;
            border: 3px solid white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        .start-btn:hover { background: #c2185b; }
        .start-btn.next { background: #00E676; color: #000; }
        .start-btn.rank-btn { background: #FF9800; }
        .start-btn.loading { opacity: 0.5; pointer-events: none; }

        /* Unit Dropdown Selector */
        .unit-select-container {
            margin-bottom: 20px;
            width: 90%;
            max-width: 400px;
        }
        
        select {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.9);
            border: 2px solid #FFD700;
            border-radius: 10px;
            font-family: 'Noto Sans TC', sans-serif;
            color: #333;
            outline: none;
            cursor: pointer;
        }
        
        option {
            background: #fff;
            color: #000;
        }
        
        optgroup {
            font-weight: bold;
            color: #555;
            background: #eee;
        }

        .floating-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 1s forwards;
            z-index: 50;
            text-shadow: 1px 1px 0 #000;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            width: 90%;
            max-width: 600px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #444;
        }

        th {
            color: #FFD700;
            font-size: 1.2rem;
        }

        .rank-1 { color: #FFD700; font-weight: bold; font-size: 1.2rem; }
        .rank-2 { color: #C0C0C0; font-weight: bold; }
        .rank-3 { color: #CD7F32; font-weight: bold; }
        .loading-text { color: #fff; font-size: 1.2rem; padding: 20px; }
        .error-text { color: #F44336; padding: 10px; font-weight: bold;}

        .input-group {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        
        #player-name-input {
            padding: 10px 20px;
            font-size: 1.5rem;
            border-radius: 10px;
            border: none;
            text-align: center;
            width: 200px;
        }
        
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .chinese-hint { font-size: 1.3rem; }
            #answer-input { font-size: 1rem; }
            .unit-btn { width: 60px; height: 60px; }
            .hp-bar-container { width: 100%; }
            .hp-bar-container.right { width: 40%; }
            #money-display { font-size: 1.2rem; top: 45px; }
            #level-indicator { font-size: 1rem; }
            #words-remaining { font-size: 0.8rem; }
            #score-display { font-size: 1rem; padding: 2px 10px; }
        }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- Battle Area -->
        <div id="canvas-container">
            <div id="hud">
                <div class="hud-left-group">
                    <div id="level-indicator">Level 1/3</div>
                    <div class="hp-bar-container">
                        <div id="player-hp" class="hp-bar"></div>
                    </div>
                </div>
                
                <div id="score-display">Score: 0</div>
                <div id="words-remaining">å‰©é¤˜å–®å­—: 0</div>
                
                <div id="money-display">$0 / 2000</div>
                <div id="shield-indicator">ğŸ›¡ï¸ ç„¡æ•µè­·ç›¾ (æ¶ˆé™¤å–®å­—ä»¥è§£é™¤)</div>
                
                <div class="hp-bar-container right">
                    <div id="enemy-hp" class="hp-bar"></div>
                </div>
            </div>
            
            <canvas id="gameCanvas"></canvas>
        </div>

        <!-- Unit Production Bar -->
        <div id="unit-bar">
            <div class="unit-btn disabled" id="btn-1" onclick="tryBuyUnit(0)">
                <span class="key-hint">1</span>
                <span class="unit-icon">ğŸ±</span>
                <span class="unit-cost">$50</span>
            </div>
            <div class="unit-btn disabled" id="btn-2" onclick="tryBuyUnit(1)">
                <span class="key-hint">2</span>
                <span class="unit-icon">ğŸ›¡ï¸</span>
                <span class="unit-cost">$150</span>
            </div>
            <div class="unit-btn disabled" id="btn-3" onclick="tryBuyUnit(2)">
                <span class="key-hint">3</span>
                <span class="unit-icon">ğŸ¦</span>
                <span class="unit-cost">$300</span>
            </div>
            <div class="unit-btn disabled" id="btn-4" onclick="tryBuyUnit(3)">
                <span class="key-hint">4</span>
                <span class="unit-icon">ğŸ¦µ</span>
                <span class="unit-cost">$600</span>
            </div>
        </div>

        <!-- Control Panel -->
        <div id="control-panel">
            <div id="word-info">
                <span id="current-meaning" class="chinese-hint">è¼‰å…¥ä¸­...</span>
                <div id="target-word-display"></div>
                <button id="speaker-btn" onclick="manualSpeak()">ğŸ”Š</button>
                <span id="reward-preview" class="reward-preview">çå‹µ: $150</span>
            </div>
            <div id="input-area">
                <input type="text" id="answer-input" placeholder="çœ‹å–®å­—æ‰“å­—..." autocomplete="off" spellcheck="false">
            </div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="overlay-screen">
        <h1>è¥¿å¯§è²“å’ªå–®å­—å¤§æˆ°çˆ­</h1>
        <h2>è¥¿å¯§è‹±é›„æ¦œ (V4ç‰ˆ)</h2>
        
        <div class="unit-select-container">
            <select id="unit-select">
                <optgroup label="Boss Challenge (é­”ç‹æŒ‘æˆ°)">
                    <option value="BOSS_BASIC">ğŸ° åŸºç¤é­”ç‹åŸ (Unit 1-12)</option>
                    <option value="BOSS_INTER">ğŸ° ä¸­ç´šé­”ç‹åŸ (Unit 13-24)</option>
                    <option value="BOSS_ADV">ğŸ° é€²éšé­”ç‹åŸ (Unit 25-36)</option>
                    <option value="BOSS_ALL" style="color:red; font-weight:bold;">â˜ ï¸ çµ‚æ¥µé­”ç‹åŸ (All Units)</option>
                </optgroup>
                <optgroup label="Basic Level (åŸºç¤ç´š)">
                    <option value="U1" selected>Unit 1: Dinosaurs</option>
                    <option value="U2">Unit 2: A Dinner Party</option>
                    <option value="U3">Unit 3: My Dear Friends</option>
                    <option value="U4">Unit 4: A Happy Way to Learn</option>
                    <option value="U5">Unit 5: Advertisement</option>
                    <option value="U6">Unit 6: Journal</option>
                    <option value="U7">Unit 7: Plastic Bags</option>
                    <option value="U8">Unit 8: Cooking for Children</option>
                    <option value="U9">Unit 9: Keith Haring</option>
                    <option value="U10">Unit 10: Visiting</option>
                    <option value="U11">Unit 11: Comic Festival</option>
                    <option value="U12">Unit 12: School Trip</option>
                </optgroup>
                <optgroup label="Intermediate Level (ä¸­ç´š)">
                    <option value="U13">Unit 13: The Less You Know</option>
                    <option value="U14">Unit 14: Insects</option>
                    <option value="U15">Unit 15: Diary</option>
                    <option value="U16">Unit 16: Our Sun and its Twin</option>
                    <option value="U17">Unit 17: Daydreamer</option>
                    <option value="U18">Unit 18: Komodo</option>
                    <option value="U19">Unit 19: Flea Market</option>
                    <option value="U20">Unit 20: Bus Schedule</option>
                    <option value="U21">Unit 21: Greetings from Spain</option>
                    <option value="U22">Unit 22: Online Learning</option>
                    <option value="U23">Unit 23: The Parrots</option>
                    <option value="U24">Unit 24: A Trip to Osaka</option>
                </optgroup>
                <optgroup label="Advanced Level (é€²éšç´š)">
                    <option value="U25">Unit 25: Vampires and Dracula</option>
                    <option value="U26">Unit 26: Blue Light</option>
                    <option value="U27">Unit 27: The True Value of Wealth</option>
                    <option value="U28">Unit 28: Dealing with Difficult People</option>
                    <option value="U29">Unit 29: Summer Plans</option>
                    <option value="U30">Unit 30: Vincent Van Gogh</option>
                    <option value="U31">Unit 31: Joining a Club</option>
                    <option value="U32">Unit 32: Bruce and the Spider</option>
                    <option value="U33">Unit 33: Business Report</option>
                    <option value="U34">Unit 34: Science News</option>
                    <option value="U35">Unit 35: Preface - Jack White</option>
                    <option value="U36">Unit 36: A Computer that Writes Poetry</option>
                </optgroup>
            </select>
        </div>

        <p>
            <b>éŠæˆ²è¦å‰‡:</b><br>
            1. <b>è‹±æ‰“ç‰¹è¨“:</b> é¸æ“‡é—œå¡ï¼Œæ­£ç¢ºè¼¸å…¥å–®å­—è³ºå–é‡‘éŒ¢ã€‚<br>
            2. å¬å–šè²“å’ªéƒ¨éšŠï¼Œæ”»ç ´æ•µäººåŸå ¡ã€‚<br>
            3. <b>é­”ç‹æ¨¡å¼</b> å°‡é­é‡ç„¡ç›¡å–®å­—èˆ‡å¼·åŠ›æ•µäººï¼<br>
        </p>
        <div>
            <button class="start-btn" onclick="startGame(1)">é–‹å§‹æˆ°é¬¥!</button>
            <button class="start-btn rank-btn" onclick="showLeaderboard()">ğŸ† è¥¿å¯§è‹±é›„æ¦œ</button>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboard-screen" class="overlay-screen" style="display: none;">
        <h1>ğŸ† è¥¿å¯§è‹±é›„æ¦œ ğŸ†</h1>
        <div class="leaderboard-container">
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>è‹±é›„</th>
                        <th>åˆ†æ•¸</th>
                        <th>æ—¥æœŸ</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Rows injected by JS -->
                </tbody>
            </table>
        </div>
        <button class="start-btn" onclick="showStartScreenFromLeaderboard()">è¿”å›ä¸»é¸å–®</button>
    </div>

    <!-- Level Complete Screen -->
    <div id="level-complete-screen" class="overlay-screen" style="display: none;">
        <h1>é—œå¡å®Œæˆ!</h1>
        <p>æ•µäººåŸºåœ°å·²æ‘§æ¯€ï¼Œæº–å‚™é€²å…¥ä¸‹ä¸€é—œï¼</p>
        <button class="start-btn next" onclick="nextLevel()">ä¸‹ä¸€é—œ</button>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen" class="overlay-screen" style="display: none;">
        <h1 id="end-title">å‹åˆ©!</h1>
        <p id="end-score-text">åˆ†æ•¸çµç®—ä¸­...</p>
        
        <div class="input-group">
            <label>ç•™ä¸‹ä½ çš„å¤§å:</label>
            <input type="text" id="player-name-input" maxlength="8" placeholder="è¼¸å…¥åå­—">
        </div>
        
        <button id="submit-score-btn" class="start-btn" onclick="submitScore()">ç™»è¨˜ä¸¦å›ä¸»é¸å–®</button>
    </div>

    <script>
        // --- è¨­å®š (Google Apps Script URL) ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwVoVjQ0h65Avgad6mg4BV05SQx3r17mI03pUdic8N94kPggvWKYSj81ejJzWZfjtEv/exec'; 

        // --- Data: 36 Units with Chinese Translations ---
        const UNIT_DATA = {
            "U1": [
                {en: "Dinosaur", zh: "æé¾"}, {en: "Close", zh: "é—œé–‰/é è¿‘"}, {en: "Learn", zh: "å­¸ç¿’"}, {en: "Earth", zh: "åœ°çƒ"},
                {en: "Past", zh: "éå»"}, {en: "Appear", zh: "å‡ºç¾"}, {en: "Million", zh: "ç™¾è¬"}, {en: "Insect", zh: "æ˜†èŸ²"},
                {en: "Except", zh: "é™¤äº†...ä¹‹å¤–"}, {en: "Die", zh: "æ­»äº¡"}, {en: "Believe", zh: "ç›¸ä¿¡"}, {en: "Space", zh: "ç©ºé–“/å¤ªç©º"},
                {en: "Hit", zh: "æ‰“æ“Š/ç¢°æ’"}, {en: "Wave", zh: "æ®æ‰‹/æ³¢æµª"}, {en: "Dirty", zh: "éª¯é«’çš„"}, {en: "Change", zh: "æ”¹è®Š"},
                {en: "Knowledge", zh: "çŸ¥è­˜"}, {en: "Ground", zh: "åœ°é¢"}, {en: "Leave", zh: "é›¢é–‹/ç•™ä¸‹"}, {en: "Include", zh: "åŒ…æ‹¬"},
                {en: "Travel", zh: "æ—…è¡Œ"}
            ],
            // ... (å…¶ä»–å–®å…ƒè³‡æ–™ä¿æŒä¸è®Šï¼Œç‚ºç¯€çœç©ºé–“çœç•¥éƒ¨åˆ†) ...
            "U36": [
                {en: "Poem", zh: "è©©"}, {en: "Pattern", zh: "æ¨¡å¼/åœ–æ¨£"}, {en: "Stop", zh: "åœæ­¢"}, {en: "Scientist", zh: "ç§‘å­¸å®¶"},
                {en: "Train", zh: "ç«è»Š/è¨“ç·´"}, {en: "Enter", zh: "é€²å…¥/è¼¸å…¥"}, {en: "Allow", zh: "å…è¨±"}, {en: "Rule", zh: "è¦å‰‡"},
                {en: "Surprised", zh: "æ„Ÿåˆ°é©šè¨çš„"}, {en: "Discover", zh: "ç™¼ç¾"}, {en: "Create", zh: "å‰µé€ "}, {en: "Ordinary", zh: "å¹³å‡¡çš„"},
                {en: "Follow", zh: "è·Ÿéš¨"}, {en: "Mistake", zh: "éŒ¯èª¤"}, {en: "Detect", zh: "åµæ¸¬"}, {en: "Comment", zh: "è©•è«–"},
                {en: "Lack", zh: "ç¼ºä¹"}, {en: "Emotion", zh: "æƒ…ç·’"}, {en: "Bother", zh: "æ‰“æ“¾"}, {en: "Bright", zh: "æ˜äº®çš„"}
            ]
        };
        
        // è£œå……çœç•¥çš„è³‡æ–™ä»¥ç¢ºä¿å®Œæ•´æ€§ (å®Œæ•´ç‰ˆéœ€è²¼ä¸Šæ‰€æœ‰ Unit è³‡æ–™)
        const MISSING_UNITS = {
            "U2": [ {en: "Plan", zh: "è¨ˆç•«"}, {en: "Weekend", zh: "é€±æœ«"}, {en: "Interested", zh: "æ„Ÿèˆˆè¶£çš„"}, {en: "Sound", zh: "è²éŸ³/è½èµ·ä¾†"}, {en: "Idea", zh: "ä¸»æ„"}, {en: "Menu", zh: "èœå–®"}, {en: "Dessert", zh: "ç”œé»"}, {en: "Tooth", zh: "ç‰™é½’"}, {en: "Chocolate", zh: "å·§å…‹åŠ›"}, {en: "Perhaps", zh: "ä¹Ÿè¨±"}, {en: "Snack", zh: "é»å¿ƒ"}, {en: "Hungry", zh: "é£¢é¤“çš„"}, {en: "Family", zh: "å®¶åº­"}, {en: "Yard", zh: "åº­é™¢"}, {en: "Enjoy", zh: "äº«å—"}, {en: "Weather", zh: "å¤©æ°£"}, {en: "Set", zh: "è¨­å®š/ä¸€çµ„"}, {en: "Date", zh: "æ—¥æœŸ/ç´„æœƒ"}, {en: "Calendar", zh: "æ—¥æ›†"}, {en: "Look forward to", zh: "æœŸå¾…"}, {en: "Soon", zh: "å¾ˆå¿«"} ],
            "U3": [ {en: "Barbecue", zh: "çƒ¤è‚‰"}, {en: "Farmer", zh: "è¾²å¤«"}, {en: "Market", zh: "å¸‚å ´"}, {en: "Chicken", zh: "é›è‚‰"}, {en: "Beef", zh: "ç‰›è‚‰"}, {en: "Pork", zh: "è±¬è‚‰"}, {en: "Plus", zh: "åŠ ä¸Š/æ­£çš„"}, {en: "Bake", zh: "çƒ˜çƒ¤"}, {en: "Side", zh: "é‚Š/é¢"}, {en: "Map", zh: "åœ°åœ–"}, {en: "Letter", zh: "ä¿¡/å­—æ¯"}, {en: "Delicious", zh: "ç¾å‘³çš„"}, {en: "Bridge", zh: "æ©‹"}, {en: "Along", zh: "æ²¿è‘—"}, {en: "Straight", zh: "ç›´çš„"}, {en: "Doctor", zh: "é†«ç”Ÿ"}, {en: "Parking lot", zh: "åœè»Šå ´"}, {en: "Cross", zh: "ç©¿è¶Š/åå­—"}, {en: "Theater", zh: "åŠ‡é™¢"}, {en: "Large", zh: "å¤§çš„"}, {en: "Balcony", zh: "é™½å°"} ],
            "U4": [ {en: "Happy", zh: "å¿«æ¨‚çš„"}, {en: "Fence", zh: "åœç±¬"}, {en: "End", zh: "çµæŸ"}, {en: "Play", zh: "ç©/æ’­æ”¾"}, {en: "Math", zh: "æ•¸å­¸"}, {en: "Say", zh: "èªª"}, {en: "Study", zh: "ç ”è®€"}, {en: "Fun", zh: "æ¨‚è¶£"}, {en: "Game", zh: "éŠæˆ²"}, {en: "Gym", zh: "é«”è‚²é¤¨"}, {en: "Climb", zh: "æ”€çˆ¬"}, {en: "Swim", zh: "æ¸¸æ³³"}, {en: "When it comes to", zh: "ç•¶æåˆ°"}, {en: "Fast", zh: "å¿«é€Ÿçš„"}, {en: "Story", zh: "æ•…äº‹"}, {en: "Stand", zh: "ç«™ç«‹/å¿å—"}, {en: "Together", zh: "ä¸€èµ·"} ],
            "U5": [ {en: "Wish", zh: "å¸Œæœ›"}, {en: "Pet", zh: "å¯µç‰©"}, {en: "Smell", zh: "è/æ°£å‘³"}, {en: "Fresh", zh: "æ–°é®®çš„"}, {en: "Complain", zh: "æŠ±æ€¨"}, {en: "Sweet", zh: "ç”œçš„"}, {en: "Mouth", zh: "å˜´å·´"}, {en: "Fault", zh: "éŒ¯èª¤/ç¼ºé»"}, {en: "Meat", zh: "è‚‰é¡"}, {en: "Moment", zh: "æ™‚åˆ»"}, {en: "Total", zh: "ç¸½è¨ˆ"}, {en: "Health", zh: "å¥åº·"}, {en: "Problem", zh: "å•é¡Œ"}, {en: "Taste", zh: "å“åš/å‘³é“"}, {en: "Habit", zh: "ç¿’æ…£"}, {en: "Brush", zh: "åˆ·/åˆ·å­"}, {en: "Twice", zh: "å…©æ¬¡"}, {en: "Smile", zh: "å¾®ç¬‘"}, {en: "Pot", zh: "é‹å­"}, {en: "Charge", zh: "æ”¶è²»/å……é›»"}, {en: "Fee", zh: "è²»ç”¨"} ],
            "U6": [ {en: "Nervous", zh: "ç·Šå¼µçš„"}, {en: "Grade", zh: "å¹´ç´š/æˆç¸¾"}, {en: "Uniform", zh: "åˆ¶æœ"}, {en: "Weak", zh: "è™›å¼±çš„"}, {en: "Compare", zh: "æ¯”è¼ƒ"}, {en: "Simple", zh: "ç°¡å–®çš„"}, {en: "Assume", zh: "å‡è¨­"}, {en: "Hang out", zh: "é–’æ™ƒ"}, {en: "Friendly", zh: "å‹å–„çš„"}, {en: "Driver", zh: "å¸æ©Ÿ"}, {en: "Copy", zh: "è¤‡è£½"}, {en: "Cover", zh: "è¦†è“‹"}, {en: "Pray", zh: "ç¥ˆç¦±"}, {en: "Proud", zh: "é©•å‚²çš„"}, {en: "Example", zh: "ä¾‹å­"}, {en: "Elementary school", zh: "å°å­¸"}, {en: "Boring", zh: "ç„¡èŠçš„"} ],
            "U7": [ {en: "Supermarket", zh: "è¶…å¸‚"}, {en: "Either", zh: "å…©è€…ä¹‹ä¸€"}, {en: "Borrow", zh: "å€Ÿå…¥"}, {en: "Least", zh: "æœ€å°‘çš„"}, {en: "Carry", zh: "æ”œå¸¶"}, {en: "Heavy", zh: "é‡çš„"}, {en: "Wet", zh: "æ¿•çš„"}, {en: "Thin", zh: "ç˜¦çš„/è–„çš„"}, {en: "Stupid", zh: "æ„šç¬¨çš„"}, {en: "Dollar", zh: "å…ƒ"}, {en: "Excuse", zh: "è—‰å£/åŸè«’"}, {en: "Nothing", zh: "æ²’ä»€éº¼"}, {en: "Environment", zh: "ç’°å¢ƒ"}, {en: "Be used to", zh: "ç¿’æ…£æ–¼"}, {en: "Probably", zh: "å¤§æ¦‚"}, {en: "Agree", zh: "åŒæ„"}, {en: "Government", zh: "æ”¿åºœ"}, {en: "Remind", zh: "æé†’"} ],
            "U8": [ {en: "Help", zh: "å¹«å¿™"}, {en: "Kitchen", zh: "å»šæˆ¿"}, {en: "Prepare", zh: "æº–å‚™"}, {en: "Meal", zh: "é¤"}, {en: "Aged", zh: "å¹´æ­²çš„"}, {en: "Hope", zh: "å¸Œæœ›"}, {en: "Independent", zh: "ç¨ç«‹çš„"}, {en: "Although", zh: "é›–ç„¶"}, {en: "Young", zh: "å¹´è¼•çš„"}, {en: "Cook", zh: "çƒ¹é£ª/å»šå¸«"}, {en: "Enough", zh: "è¶³å¤ çš„"}, {en: "Oven", zh: "çƒ¤ç®±"}, {en: "Knife", zh: "åˆ€å­"}, {en: "Vegetable", zh: "è”¬èœ"}, {en: "Dish", zh: "ç›¤å­/èœé¤š"}, {en: "Clean up", zh: "æ¸…ç†"}, {en: "Information", zh: "è³‡è¨Š"}, {en: "Child", zh: "å­©å­"}, {en: "Local", zh: "ç•¶åœ°çš„"}, {en: "Library", zh: "åœ–æ›¸é¤¨"}, {en: "Internet", zh: "ç¶²éš›ç¶²è·¯"}, {en: "Patient", zh: "æœ‰è€å¿ƒçš„/ç—…äºº"} ],
            "U9": [ {en: "Symbol", zh: "è±¡å¾µ/ç¬¦è™Ÿ"}, {en: "Famous", zh: "è‘—åçš„"}, {en: "Face", zh: "è‡‰/é¢å°"}, {en: "Because", zh: "å› ç‚º"}, {en: "Different", zh: "ä¸åŒçš„"}, {en: "Equal", zh: "å¹³ç­‰çš„"}, {en: "Show", zh: "å±•ç¤º/è¡¨æ¼”"}, {en: "Hold up", zh: "èˆ‰èµ·/æ”¯æ’"}, {en: "Heart", zh: "å¿ƒ"}, {en: "Power", zh: "åŠ›é‡/æ¬ŠåŠ›"}, {en: "Human", zh: "äººé¡"}, {en: "Feel", zh: "æ„Ÿè¦º"}, {en: "Joy", zh: "å–œæ‚…"}, {en: "Line", zh: "ç·š/æ’éšŠ"}, {en: "Around", zh: "å‘¨åœ"}, {en: "Call", zh: "æ‰“é›»è©±/å‘¼å«"}, {en: "Energy", zh: "èƒ½é‡/ç²¾åŠ›"}, {en: "Paint", zh: "ç¹ªç•«/é¡æ–™"}, {en: "Sick", zh: "ç”Ÿç—…çš„"}, {en: "Important", zh: "é‡è¦çš„"}, {en: "Hug", zh: "æ“æŠ±"} ],
            "U10": [ {en: "Guess", zh: "çŒœæ¸¬"}, {en: "Visit", zh: "æ‹œè¨ª"}, {en: "Celebrate", zh: "æ…¶ç¥"}, {en: "In fact", zh: "äº‹å¯¦ä¸Š"}, {en: "Miss", zh: "æƒ³å¿µ/éŒ¯é"}, {en: "Since", zh: "è‡ªå¾/å› ç‚º"}, {en: "As well as", zh: "ä»¥åŠ"}, {en: "Mark", zh: "æ¨™è¨˜/åˆ†æ•¸"}, {en: "Be born", zh: "å‡ºç”Ÿ"}, {en: "Wait", zh: "ç­‰å¾…"}, {en: "Already", zh: "å·²ç¶“"}, {en: "Ticket", zh: "ç¥¨"}, {en: "Arrive", zh: "æŠµé”"}, {en: "Party", zh: "æ´¾å°/é»¨æ´¾"}, {en: "Once", zh: "æ›¾ç¶“/ä¸€æ¬¡"}, {en: "Public", zh: "å…¬çœ¾çš„"}, {en: "Excited", zh: "èˆˆå¥®çš„"}, {en: "Activity", zh: "æ´»å‹•"}, {en: "Flight", zh: "ç­æ©Ÿ/é£›è¡Œ"}, {en: "Niece", zh: "å§ªå¥³/å¤–ç”¥å¥³"}, {en: "Nephew", zh: "å§ªå­/å¤–ç”¥"}, {en: "Department store", zh: "ç™¾è²¨å…¬å¸"}, {en: "Forget", zh: "å¿˜è¨˜"}, {en: "Return", zh: "è¿”å›/æ­¸é‚„"} ],
            "U11": [ {en: "Comic", zh: "æ¼«ç•«"}, {en: "Town", zh: "åŸé®"}, {en: "Festival", zh: "ç¯€æ—¥"}, {en: "Character", zh: "è§’è‰²/æ€§æ ¼"}, {en: "Latest", zh: "æœ€æ–°çš„"}, {en: "Popular", zh: "å—æ­¡è¿çš„"}, {en: "Video", zh: "å½±ç‰‡"}, {en: "Rare", zh: "ç½•è¦‹çš„"}, {en: "Collect", zh: "æ”¶é›†"}, {en: "Hard", zh: "å›°é›£çš„/ç¡¬çš„"}, {en: "Welcome", zh: "æ­¡è¿"}, {en: "Guest", zh: "å®¢äºº"}, {en: "Win", zh: "è´"}, {en: "Magic", zh: "é­”è¡“"}, {en: "Successful", zh: "æˆåŠŸçš„"}, {en: "Early", zh: "æ—©çš„"}, {en: "Half", zh: "ä¸€åŠ"}, {en: "Price", zh: "åƒ¹æ ¼"}, {en: "Sell", zh: "è³£"} ],
            "U12": [ {en: "Afternoon", zh: "ä¸‹åˆ"}, {en: "Downtown", zh: "å¸‚ä¸­å¿ƒ"}, {en: "Hiking", zh: "å¥è¡Œ"}, {en: "Mountain", zh: "å±±"}, {en: "Picnic", zh: "é‡é¤"}, {en: "Seafood", zh: "æµ·é®®"}, {en: "Candy", zh: "ç³–æœ"}, {en: "Island", zh: "å³¶å¶¼"}, {en: "Pool", zh: "æ± å­/æ’çƒ"}, {en: "Notice", zh: "æ³¨æ„/é€šçŸ¥"}, {en: "Breakfast", zh: "æ—©é¤"}, {en: "Sharp", zh: "å°–éŠ³çš„/æº–æ™‚"}, {en: "Draw", zh: "ç•«/å¸å¼•"}, {en: "Thirsty", zh: "å£æ¸´çš„"}, {en: "Prize", zh: "çå“"}, {en: "Winner", zh: "è´å®¶"}, {en: "Dry", zh: "ä¹¾çš„"}, {en: "Cap", zh: "æ£’çƒå¸½"}, {en: "Lend", zh: "å€Ÿå‡º"}, {en: "Pack", zh: "æ‰“åŒ…"} ],
            "U13": [ {en: "Less", zh: "è¼ƒå°‘çš„"}, {en: "Neighbor", zh: "é„°å±…"}, {en: "Helpful", zh: "æœ‰å¹«åŠ©çš„"}, {en: "Street", zh: "è¡—é“"}, {en: "Disappear", zh: "æ¶ˆå¤±"}, {en: "Concern", zh: "é—œå¿ƒ/æ“”æ†‚"}, {en: "Voice", zh: "è²éŸ³"}, {en: "Lie", zh: "èªªè¬Š/èºº"}, {en: "Wake", zh: "é†’ä¾†"}, {en: "Strange", zh: "å¥‡æ€ªçš„"}, {en: "Noise", zh: "å™ªéŸ³"}, {en: "Seem", zh: "ä¼¼ä¹"}, {en: "Certain", zh: "ç¢ºå®šçš„"}, {en: "Easily", zh: "å®¹æ˜“åœ°"}, {en: "Freezing", zh: "æ¥µå†·çš„"}, {en: "Knock", zh: "æ•²"}, {en: "Front", zh: "å‰é¢"}, {en: "Sorry", zh: "æŠ±æ­‰çš„"}, {en: "Invite", zh: "é‚€è«‹"}, {en: "Visitor", zh: "è¨ªå®¢"}, {en: "Shake", zh: "æ–å‹•"}, {en: "Brave", zh: "å‹‡æ•¢çš„"}, {en: "Page", zh: "é "} ],
            "U14": [ {en: "In order to", zh: "ç‚ºäº†"}, {en: "Bite", zh: "å’¬"}, {en: "Modern", zh: "ç¾ä»£çš„"}, {en: "Fear", zh: "ææ‡¼"}, {en: "Contact", zh: "æ¥è§¸/è¯çµ¡"}, {en: "Nature", zh: "è‡ªç„¶"}, {en: "Waste", zh: "æµªè²»/å»¢æ£„ç‰©"}, {en: "Fruit", zh: "æ°´æœ"}, {en: "Feed", zh: "é¤µé£Ÿ"}, {en: "Later", zh: "ç¨å¾Œ"}, {en: "Report", zh: "å ±å‘Š"}, {en: "Type", zh: "é¡å‹/æ‰“å­—"}, {en: "Bee", zh: "èœœèœ‚"}, {en: "Butterfly", zh: "è´è¶"}, {en: "Clearly", zh: "æ¸…æ¥šåœ°"}, {en: "Farm", zh: "è¾²å ´"}, {en: "Pollution", zh: "æ±¡æŸ“"}, {en: "Serious", zh: "åš´é‡çš„"}, {en: "Everywhere", zh: "åˆ°è™•"}, {en: "Kill", zh: "æ®ºæ­»"} ],
            "U15": [ {en: "Diary", zh: "æ—¥è¨˜"}, {en: "Mean", zh: "æ„æŒ‡/åˆ»è–„çš„"}, {en: "Pass", zh: "é€šé/å‚³é"}, {en: "Note", zh: "ç­†è¨˜/ä¾¿æ¢"}, {en: "Admire", zh: "æ¬½ä½©/æ¬£è³"}, {en: "Point", zh: "é»/æŒ‡å‡º"}, {en: "Stranger", zh: "é™Œç”Ÿäºº"}, {en: "Embarrass", zh: "ä½¿å°·å°¬"}, {en: "Burst into", zh: "çªç„¶çˆ†ç™¼"}, {en: "Tear", zh: "çœ¼æ·š/æ’•è£‚"}, {en: "Honest", zh: "èª å¯¦çš„"}, {en: "Principal", zh: "æ ¡é•·/ä¸»è¦çš„"}, {en: "Office", zh: "è¾¦å…¬å®¤"}, {en: "Happen", zh: "ç™¼ç”Ÿ"}, {en: "Trouble", zh: "éº»ç…©"}, {en: "Laugh", zh: "ç¬‘"}, {en: "Funny", zh: "å¥½ç¬‘çš„"}, {en: "Listen", zh: "è½"}, {en: "Friendship", zh: "å‹èª¼"} ],
            "U16": [ {en: "Almost", zh: "å¹¾ä¹"}, {en: "Sun", zh: "å¤ªé™½"}, {en: "No longer", zh: "ä¸å†"}, {en: "Universe", zh: "å®‡å®™"}, {en: "Shine", zh: "ç…§è€€"}, {en: "Shape", zh: "å½¢ç‹€"}, {en: "Motion", zh: "å‹•ä½œ/ç§»å‹•"}, {en: "Chemistry", zh: "åŒ–å­¸"}, {en: "Heat", zh: "ç†±åº¦"}, {en: "Crowded", zh: "æ“æ“ çš„"}, {en: "Area", zh: "å€åŸŸ"}, {en: "Piece", zh: "ä¸€ç‰‡/å¼µ"}, {en: "Each other", zh: "å½¼æ­¤"}, {en: "Lucky", zh: "å¹¸é‹çš„"}, {en: "Planet", zh: "è¡Œæ˜Ÿ"}, {en: "Distance", zh: "è·é›¢"}, {en: "Maybe", zh: "ä¹Ÿè¨±"}, {en: "Dream", zh: "å¤¢æƒ³"}, {en: "Possible", zh: "å¯èƒ½çš„"}, {en: "Slim", zh: "è‹—æ¢çš„"}, {en: "Belong", zh: "å±¬æ–¼"} ],
            "U17": [ {en: "Lock", zh: "é–"}, {en: "Homework", zh: "ä½œæ¥­"}, {en: "Princess", zh: "å…¬ä¸»"}, {en: "Blanket", zh: "æ¯¯å­"}, {en: "Couch", zh: "é•·æ²™ç™¼"}, {en: "Glass", zh: "ç»ç’ƒ/æ¯å­"}, {en: "Chopstick", zh: "ç­·å­"}, {en: "Step", zh: "è…³æ­¥/æ­¥é©Ÿ"}, {en: "Bench", zh: "é•·æ¤…"}, {en: "Toe", zh: "è…³è¶¾"}, {en: "Giant", zh: "å·¨äºº/å·¨å¤§çš„"}, {en: "Sheet", zh: "åºŠå–®/ä¸€å¼µ"}, {en: "Ghost", zh: "é¬¼"}, {en: "Ill", zh: "ç”Ÿç—…çš„"}, {en: "Head", zh: "é ­"}, {en: "Nurse", zh: "è­·å£«"}, {en: "Actress", zh: "å¥³æ¼”å“¡"}, {en: "Pop", zh: "æµè¡Œ/ç™¼å‡ºæ³¢è²"}, {en: "Imagine", zh: "æƒ³åƒ"} ],
            "U18": [ {en: "Between", zh: "åœ¨...ä¹‹é–“"}, {en: "Ocean", zh: "æµ·æ´‹"}, {en: "Tiny", zh: "å¾®å°çš„"}, {en: "Fill", zh: "å……æ»¿"}, {en: "Ancient", zh: "å¤ä»£çš„"}, {en: "Exist", zh: "å­˜åœ¨"}, {en: "Grow", zh: "æˆé•·"}, {en: "Tail", zh: "å°¾å·´"}, {en: "Hunt", zh: "æ‰“çµ"}, {en: "Poison", zh: "æ¯’è—¥"}, {en: "Blood", zh: "è¡€æ¶²"}, {en: "Hurt", zh: "å‚·å®³/ç—›"}, {en: "Until", zh: "ç›´åˆ°"}, {en: "Seldom", zh: "å¾ˆå°‘"}, {en: "Attack", zh: "æ”»æ“Š"}, {en: "Afraid", zh: "å®³æ€•çš„"}, {en: "Near", zh: "é è¿‘"}, {en: "Though", zh: "é›–ç„¶"}, {en: "Kind", zh: "ç¨®é¡/ä»æ…ˆçš„"}, {en: "Unique", zh: "ç¨ç‰¹çš„"}, {en: "Sand", zh: "æ²™å­"}, {en: "Weather", zh: "å¤©æ°£"} ],
            "U19": [ {en: "Bear", zh: "ç†Š/å¿å—"}, {en: "River", zh: "æ²³æµ"}, {en: "Closet", zh: "è¡£æ«¥"}, {en: "Free", zh: "å…è²»çš„/è‡ªç”±çš„"}, {en: "Accept", zh: "æ¥å—"}, {en: "Receive", zh: "æ”¶åˆ°"}, {en: "Size", zh: "å°ºå¯¸"}, {en: "Underwear", zh: "å…§è¡£"}, {en: "Sock", zh: "è¥ªå­"}, {en: "Hat", zh: "å¸½å­"}, {en: "Scarf", zh: "åœå·¾"}, {en: "Glove", zh: "æ‰‹å¥—"}, {en: "Ring", zh: "æˆ’æŒ‡/éˆ´è²"}, {en: "Remember", zh: "è¨˜å¾—"}, {en: "Raise", zh: "èˆ‰èµ·/é¤Šè‚²"}, {en: "Drink", zh: "å–/é£²æ–™"}, {en: "Cash", zh: "ç¾é‡‘"}, {en: "Credit card", zh: "ä¿¡ç”¨å¡"} ],
            "U20": [ {en: "Castle", zh: "åŸå ¡"}, {en: "Hall", zh: "å¤§å»³"}, {en: "Spring", zh: "æ˜¥å¤©/æ³‰æ°´"}, {en: "Square", zh: "å»£å ´/æ­£æ–¹å½¢"}, {en: "Central", zh: "ä¸­å¤®çš„"}, {en: "Sport", zh: "é‹å‹•"}, {en: "Station", zh: "è»Šç«™"}, {en: "Tunnel", zh: "éš§é“"}, {en: "Regular", zh: "è¦å¾‹çš„"}, {en: "National", zh: "åœ‹å®¶çš„"}, {en: "Fee", zh: "è²»ç”¨"}, {en: "Circle", zh: "åœ“åœˆ"}, {en: "Express", zh: "è¡¨é”/å¿«é"}, {en: "Service", zh: "æœå‹™"}, {en: "Youth", zh: "é’æ˜¥/é’å¹´"}, {en: "Cheap", zh: "ä¾¿å®œçš„"}, {en: "Extra", zh: "é¡å¤–çš„"}, {en: "Seat", zh: "åº§ä½"}, {en: "Traffic", zh: "äº¤é€š"} ],
            "U21": [ {en: "Send", zh: "å¯„é€"}, {en: "Quick", zh: "å¿«é€Ÿçš„"}, {en: "Vacation", zh: "å‡æœŸ"}, {en: "Fantastic", zh: "æ¥µå¥½çš„"}, {en: "Musician", zh: "éŸ³æ¨‚å®¶"}, {en: "Instrument", zh: "å„€å™¨/æ¨‚å™¨"}, {en: "Sidewalk", zh: "äººè¡Œé“"}, {en: "Outside", zh: "å¤–é¢"}, {en: "Favorite", zh: "æœ€å–œæ„›çš„"}, {en: "Interesting", zh: "æœ‰è¶£çš„"}, {en: "Especially", zh: "ç‰¹åˆ¥æ˜¯"}, {en: "Design", zh: "è¨­è¨ˆ"}, {en: "Restaurant", zh: "é¤å»³"}, {en: "Tonight", zh: "ä»Šæ™š"}, {en: "Surprise", zh: "é©šå–œ"}, {en: "Secret", zh: "ç§˜å¯†"}, {en: "Photo", zh: "ç…§ç‰‡"}, {en: "Inside", zh: "è£¡é¢"}, {en: "Ruin", zh: "æ¯€å£/éºè·¡"}, {en: "Break", zh: "æ‰“ç ´/ä¼‘æ¯"}, {en: "Time off", zh: "ä¼‘å‡"} ],
            "U22": [ {en: "Paper", zh: "ç´™"}, {en: "Biology", zh: "ç”Ÿç‰©å­¸"}, {en: "Course", zh: "èª²ç¨‹/è·¯ç·š"}, {en: "Actually", zh: "å¯¦éš›ä¸Š"}, {en: "Lonely", zh: "å¯‚å¯çš„"}, {en: "Classmate", zh: "åŒç­åŒå­¸"}, {en: "Abroad", zh: "åœ‹å¤–"}, {en: "Busy", zh: "å¿™ç¢Œçš„"}, {en: "Pick", zh: "æŒ‘é¸/æ’¿"}, {en: "Foreign", zh: "å¤–åœ‹çš„"}, {en: "College", zh: "å¤§å­¸"}, {en: "Education", zh: "æ•™è‚²"}, {en: "Lesson", zh: "èª²ç¨‹/æ•™è¨“"}, {en: "Gain", zh: "ç²å¾—/å¢åŠ "}, {en: "Matter", zh: "äº‹æƒ…/é‡è¦"}, {en: "Tired", zh: "ç–²ç´¯çš„"}, {en: "Lazy", zh: "æ‡¶æƒ°çš„"}, {en: "Effort", zh: "åŠªåŠ›"} ],
            "U23": [ {en: "Become", zh: "è®Šæˆ"}, {en: "Parrot", zh: "é¸šéµ¡"}, {en: "Alone", zh: "ç¨è‡ªçš„"}, {en: "Cruel", zh: "æ®˜å¿çš„"}, {en: "Hunter", zh: "çµäºº"}, {en: "Catch", zh: "æ‰ä½/æ¥"}, {en: "Drop", zh: "æ‰è½"}, {en: "Finally", zh: "çµ‚æ–¼"}, {en: "Church", zh: "æ•™å ‚"}, {en: "Take care of", zh: "ç…§é¡§"}, {en: "Both", zh: "å…©è€…éƒ½"}, {en: "Through", zh: "ç©¿é"}, {en: "Yell", zh: "å¤§å«"}, {en: "Scare", zh: "é©šåš‡"}, {en: "Hurry", zh: "åŒ†å¿™"}, {en: "Greet", zh: "å•å€™"}, {en: "Likely", zh: "å¯èƒ½çš„"}, {en: "Terrible", zh: "å¯æ€•çš„"}, {en: "Language", zh: "èªè¨€"}, {en: "Treat", zh: "å°å¾…/è«‹å®¢"} ],
            "U24": [ {en: "Trip", zh: "æ—…è¡Œ"}, {en: "Sign up", zh: "å ±å"}, {en: "Center", zh: "ä¸­å¿ƒ"}, {en: "Influence", zh: "å½±éŸ¿"}, {en: "History", zh: "æ­·å²"}, {en: "Experience", zh: "ç¶“é©—"}, {en: "Path", zh: "å°å¾‘"}, {en: "A couple of", zh: "å¹¾å€‹"}, {en: "Arrange", zh: "å®‰æ’"}, {en: "Chance", zh: "æ©Ÿæœƒ"}, {en: "Great", zh: "å¾ˆæ£’çš„"}, {en: "Short", zh: "çŸ­çš„/çŸ®çš„"}, {en: "Ride", zh: "é¨/æ­ä¹˜"}, {en: "Offer", zh: "æä¾›"}, {en: "Order", zh: "é»é¤/å‘½ä»¤"}, {en: "Machine", zh: "æ©Ÿå™¨"}, {en: "Shop", zh: "å•†åº—"}, {en: "Fashionable", zh: "æ™‚å°šçš„"}, {en: "Clothes", zh: "è¡£æœ"}, {en: "Building", zh: "å»ºç¯‰ç‰©"}, {en: "Tower", zh: "å¡”"} ],
            "U25": [ {en: "Well-dressed", zh: "ç©¿è‘—å¾—é«”"}, {en: "Polite", zh: "æœ‰ç¦®è²Œçš„"}, {en: "However", zh: "ç„¶è€Œ"}, {en: "Dark", zh: "é»‘æš—çš„"}, {en: "Mirror", zh: "é¡å­"}, {en: "Century", zh: "ä¸–ç´€"}, {en: "Death", zh: "æ­»äº¡"}, {en: "Explain", zh: "è§£é‡‹"}, {en: "Dig up", zh: "æŒ–æ˜"}, {en: "Body", zh: "èº«é«”"}, {en: "Find", zh: "ç™¼ç¾"}, {en: "Alive", zh: "æ´»è‘—çš„"}, {en: "Corner", zh: "è§’è½"}, {en: "Hear", zh: "è½è¦‹"}, {en: "News", zh: "æ–°è"}, {en: "Monster", zh: "æ€ªç‰©"}, {en: "Buffet", zh: "è‡ªåŠ©é¤"}, {en: "Dawn", zh: "é»æ˜"}, {en: "Attention", zh: "æ³¨æ„"}, {en: "Clear", zh: "æ¸…æ¥šçš„"}, {en: "Cause", zh: "é€ æˆ/åŸå› "}, {en: "Fight", zh: "æ‰“æ¶"} ],
            "U26": [ {en: "Protect", zh: "ä¿è­·"}, {en: "Several", zh: "å¹¾å€‹"}, {en: "Amount", zh: "æ•¸é‡"}, {en: "Electric", zh: "é›»çš„"}, {en: "Turn on", zh: "æ‰“é–‹(é›»æº)"}, {en: "Produce", zh: "ç”Ÿç”¢"}, {en: "Block", zh: "é˜»æ“‹/è¡—å€"}, {en: "Worry about", zh: "æ“”å¿ƒ"}, {en: "Damage", zh: "æå®³"}, {en: "Dangerous", zh: "å±éšªçš„"}, {en: "Screen", zh: "è¢å¹•"}, {en: "Pain", zh: "ç–¼ç—›"}, {en: "Effect", zh: "æ•ˆæœ/å½±éŸ¿"}, {en: "Fool", zh: "æ„šå¼„/å‚»ç“œ"}, {en: "Fall asleep", zh: "ç¡è‘—"}, {en: "Blind", zh: "ççš„"}, {en: "Improve", zh: "æ”¹å–„"}, {en: "During", zh: "åœ¨...æœŸé–“"}, {en: "Advise", zh: "å»ºè­°"}, {en: "Special", zh: "ç‰¹åˆ¥çš„"}, {en: "Make a difference", zh: "ç”¢ç”Ÿå½±éŸ¿"}, {en: "Method", zh: "æ–¹æ³•"}, {en: "Minute", zh: "åˆ†é˜"}, {en: "Second", zh: "ç§’/ç¬¬äºŒ"} ],
            "U27": [ {en: "Value", zh: "åƒ¹å€¼"}, {en: "Save", zh: "å„²å­˜/æ‹¯æ•‘"}, {en: "Gold", zh: "é»ƒé‡‘"}, {en: "Spot", zh: "æ–‘é»/åœ°é»"}, {en: "Hide", zh: "èº²è—"}, {en: "Open", zh: "æ‰“é–‹"}, {en: "Count", zh: "æ•¸"}, {en: "Coin", zh: "ç¡¬å¹£"}, {en: "Last", zh: "æŒçºŒ/æœ€å¾Œçš„"}, {en: "Shut", zh: "é—œä¸Š"}, {en: "Next", zh: "ä¸‹ä¸€å€‹"}, {en: "Again", zh: "å†ä¸€æ¬¡"}, {en: "Wild", zh: "é‡ç”Ÿçš„"}, {en: "Anger", zh: "æ†¤æ€’"}, {en: "Curious", zh: "å¥½å¥‡çš„"}, {en: "Wrong", zh: "éŒ¯èª¤çš„"}, {en: "Rob", zh: "æ¶åŠ«"}, {en: "Shout", zh: "å¤§å«"}, {en: "Answer", zh: "å›ç­”"}, {en: "Throw", zh: "æŠ•æ“²"}, {en: "Stone", zh: "çŸ³é ­"}, {en: "Deep", zh: "æ·±çš„"}, {en: "Hole", zh: "æ´"} ],
            "U28": [ {en: "Deal", zh: "è™•ç†/äº¤æ˜“"}, {en: "Common", zh: "å¸¸è¦‹çš„"}, {en: "Difficult", zh: "å›°é›£çš„"}, {en: "Easy", zh: "å®¹æ˜“çš„"}, {en: "Tip", zh: "ç§˜è¨£/å°è²»"}, {en: "Kingdom", zh: "ç‹åœ‹"}, {en: "Angry", zh: "ç”Ÿæ°£çš„"}, {en: "Toward", zh: "æœå‘"}, {en: "Negative", zh: "è² é¢çš„"}, {en: "Argue", zh: "çˆ­åµ"}, {en: "Behave", zh: "è¡¨ç¾"}, {en: "Fly", zh: "é£›"}, {en: "Calm", zh: "å†·éœçš„"}, {en: "Avoid", zh: "é¿å…"}, {en: "Eagle", zh: "è€é·¹"}, {en: "Above", zh: "åœ¨...ä¹‹ä¸Š"}, {en: "Far", zh: "é çš„"}, {en: "Understand", zh: "äº†è§£"}, {en: "Humor", zh: "å¹½é»˜"}, {en: "Joke", zh: "ç¬‘è©±"} ],
            "U29": [ {en: "Summer", zh: "å¤å¤©"}, {en: "Yet", zh: "é‚„(æ²’)"}, {en: "Camp", zh: "éœ²ç‡Ÿ"}, {en: "Beach", zh: "æµ·ç˜"}, {en: "Cool", zh: "æ¶¼çˆ½çš„/é…·"}, {en: "Holiday", zh: "å‡æ—¥"}, {en: "Adult", zh: "æˆäºº"}, {en: "Nice looking", zh: "å¥½çœ‹çš„"}, {en: "Swimsuit", zh: "æ³³è¡£"}, {en: "Earn", zh: "è³ºå–"}, {en: "Freedom", zh: "è‡ªç”±"}, {en: "Semester", zh: "å­¸æœŸ"}, {en: "Hardly", zh: "å¹¾ä¹ä¸"}, {en: "Exam", zh: "è€ƒè©¦"}, {en: "Physics", zh: "ç‰©ç†"}, {en: "Mix", zh: "æ··åˆ"}, {en: "Evening", zh: "å‚æ™š"}, {en: "Table tennis", zh: "æ¡Œçƒ"}, {en: "Rock", zh: "å²©çŸ³/æ–æ»¾"}, {en: "Consider", zh: "è€ƒæ…®"}, {en: "Join", zh: "åŠ å…¥"} ],
            "U30": [ {en: "Painter", zh: "ç•«å®¶"}, {en: "Owner", zh: "æ“æœ‰è€…"}, {en: "Sale", zh: "éŠ·å”®"}, {en: "Case", zh: "æ¡ˆä»¶/ç›’å­"}, {en: "Know", zh: "çŸ¥é“"}, {en: "Nor", zh: "ä¹Ÿä¸"}, {en: "Appreciate", zh: "æ¬£è³/æ„Ÿæ¿€"}, {en: "Precious", zh: "çè²´çš„"}, {en: "Latter", zh: "å¾Œè€…"}, {en: "Inspire", zh: "å•Ÿç™¼"}, {en: "Artist", zh: "è—è¡“å®¶"}, {en: "Besides", zh: "æ­¤å¤–"}, {en: "Bring up", zh: "æ’«é¤Š/æå‡º"}, {en: "Conversation", zh: "å°è©±"}, {en: "Usually", zh: "é€šå¸¸"}, {en: "State", zh: "ç‹€æ…‹/å·"}, {en: "Mind", zh: "ä»‹æ„/å¿ƒæ™º"}, {en: "Spend", zh: "èŠ±è²»"}, {en: "Hospital", zh: "é†«é™¢"}, {en: "Another", zh: "å¦ä¸€å€‹"}, {en: "Crazy", zh: "ç˜‹ç‹‚çš„"}, {en: "Wonderful", zh: "ç¾å¥½çš„"} ],
            "U31": [ {en: "Bored", zh: "æ„Ÿåˆ°ç„¡èŠçš„"}, {en: "Hobby", zh: "å—œå¥½"}, {en: "Same", zh: "ç›¸åŒçš„"}, {en: "Lovely", zh: "å¯æ„›çš„"}, {en: "Provide", zh: "æä¾›"}, {en: "Choose", zh: "é¸æ“‡"}, {en: "Opinion", zh: "æ„è¦‹"}, {en: "Science", zh: "ç§‘å­¸"}, {en: "Drama", zh: "æˆ²åŠ‡"}, {en: "Debate", zh: "è¾¯è«–"}, {en: "Team", zh: "éšŠä¼"}, {en: "Select", zh: "æŒ‘é¸"}, {en: "Member", zh: "æˆå“¡"}, {en: "Meeting", zh: "æœƒè­°"}, {en: "Weekday", zh: "å·¥ä½œæ—¥"}, {en: "Speech", zh: "æ¼”è¬›"}, {en: "International", zh: "åœ‹éš›çš„"}, {en: "Event", zh: "äº‹ä»¶/æ´»å‹•"}, {en: "Climate", zh: "æ°£å€™"}, {en: "Elect", zh: "é¸èˆ‰"}, {en: "President", zh: "ç¸½çµ±/æ ¡é•·"}, {en: "Invent", zh: "ç™¼æ˜"}, {en: "Build", zh: "å»ºé€ "} ],
            "U32": [ {en: "Spider", zh: "èœ˜è››"}, {en: "Land", zh: "åœŸåœ°"}, {en: "Desire", zh: "æ¸´æœ›"}, {en: "Control", zh: "æ§åˆ¶"}, {en: "Lead", zh: "é ˜å°"}, {en: "Army", zh: "è»éšŠ"}, {en: "Drive out", zh: "é©…è¶•"}, {en: "Lose", zh: "è¼¸/éºå¤±"}, {en: "Soldier", zh: "å£«å…µ"}, {en: "Run away", zh: "é€ƒè·‘"}, {en: "Seek out", zh: "æ‰¾å‡º"}, {en: "Give up", zh: "æ”¾æ£„"}, {en: "Across", zh: "æ©«è¶Š"}, {en: "Roof", zh: "å±‹é ‚"}, {en: "Fail", zh: "å¤±æ•—"}, {en: "Poor", zh: "è²§çª®çš„/å¯æ†çš„"}, {en: "Alike", zh: "ç›¸ä¼¼çš„"}, {en: "Quit", zh: "é€€å‡º/æˆ’é™¤"}, {en: "Succeed", zh: "æˆåŠŸ"}, {en: "Sense", zh: "æ„Ÿè¦º"}, {en: "Gather", zh: "èšé›†"}, {en: "Spread", zh: "æ•£æ’­"}, {en: "Beat", zh: "æ‰“æ•—/æ•²æ‰“"}, {en: "Enemy", zh: "æ•µäºº"}, {en: "Push", zh: "æ¨"}, {en: "Country", zh: "åœ‹å®¶"} ],
            "U33": [ {en: "Top", zh: "é ‚ç«¯"}, {en: "Choice", zh: "é¸æ“‡"}, {en: "Worker", zh: "å·¥äºº"}, {en: "Host", zh: "ä¸»äºº/ä¸»æŒ"}, {en: "Partner", zh: "å¤¥ä¼´"}, {en: "Customer", zh: "é¡§å®¢"}, {en: "Make up", zh: "çµ„æˆ/åŒ–å¦"}, {en: "Income", zh: "æ”¶å…¥"}, {en: "Employ", zh: "é›‡ç”¨"}, {en: "Handle", zh: "è™•ç†/æŠŠæ‰‹"}, {en: "Waitress", zh: "å¥³æœå‹™ç”Ÿ"}, {en: "Quiet", zh: "å®‰éœçš„"}, {en: "Period", zh: "æ™‚æœŸ/å¥é»"}, {en: "Useful", zh: "æœ‰ç”¨çš„"}, {en: "Hire", zh: "é›‡ç”¨"}, {en: "Available", zh: "å¯ç”¨çš„"}, {en: "Therefore", zh: "å› æ­¤"}, {en: "Active", zh: "æ´»èºçš„"}, {en: "Solve", zh: "è§£æ±º"}, {en: "Interview", zh: "é¢è©¦"}, {en: "Decision", zh: "æ±ºå®š"}, {en: "Discuss", zh: "è¨è«–"} ],
            "U34": [ {en: "Read", zh: "é–±è®€"}, {en: "Sample", zh: "æ¨£å“"}, {en: "Cancer", zh: "ç™Œç—‡"}, {en: "Program", zh: "ç¨‹å¼/ç¯€ç›®"}, {en: "Continue", zh: "ç¹¼çºŒ"}, {en: "Cure", zh: "æ²»ç™’"}, {en: "Doubt", zh: "æ‡·ç–‘"}, {en: "Rise", zh: "ä¸Šå‡"}, {en: "Smart", zh: "è°æ˜çš„"}, {en: "Suggest", zh: "å»ºè­°"}, {en: "Robot", zh: "æ©Ÿå™¨äºº"}, {en: "Direct", zh: "ç›´æ¥çš„"}, {en: "Message", zh: "è¨Šæ¯"}, {en: "Real", zh: "çœŸå¯¦çš„"}, {en: "Group", zh: "ç¾¤çµ„"}, {en: "Form", zh: "å½¢å¼/è¡¨æ ¼"}, {en: "Society", zh: "ç¤¾æœƒ"}, {en: "Project", zh: "å°ˆæ¡ˆ"}, {en: "Difficulty", zh: "å›°é›£"}, {en: "Decide", zh: "æ±ºå®š"}, {en: "Carefully", zh: "å°å¿ƒåœ°"} ],
            "U35": [ {en: "Turn around", zh: "è½‰èº«/å¥½è½‰"}, {en: "Coach", zh: "æ•™ç·´"}, {en: "Chubby", zh: "åœ“èƒ–çš„"}, {en: "Overweight", zh: "éé‡çš„"}, {en: "Develop", zh: "ç™¼å±•"}, {en: "Teenager", zh: "é’å°‘å¹´"}, {en: "Exercise", zh: "é‹å‹•"}, {en: "Burger", zh: "æ¼¢å ¡"}, {en: "Direction", zh: "æ–¹å‘"}, {en: "Hate", zh: "è¨å­"}, {en: "Dead", zh: "æ­»çš„"}, {en: "Feeling", zh: "æ„Ÿè¦º"}, {en: "Frightened", zh: "å—é©šçš„"}, {en: "Begin", zh: "é–‹å§‹"}, {en: "Realize", zh: "äº†è§£/å¯¦ç¾"}, {en: "Burn off", zh: "ç‡ƒç‡’(æ¶ˆè€—)"}, {en: "Fat", zh: "èƒ–çš„/è„‚è‚ª"}, {en: "Belt", zh: "çš®å¸¶"}, {en: "Work out", zh: "å¥èº«/è§£æ±º"}, {en: "Positive", zh: "æ­£é¢çš„"}, {en: "Goal", zh: "ç›®æ¨™"}, {en: "Impossible", zh: "ä¸å¯èƒ½çš„"} ]
        };
        // Merge missing units into UNIT_DATA
        Object.assign(UNIT_DATA, MISSING_UNITS);

        // --- Game Config & State ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let animationId;
        let lastTime = 0;
        
        const GAME_WIDTH = 1000;
        const GAME_HEIGHT = 400;
        const GROUND_Y = 320;
        const BASE_WIDTH = 100; // åŸå ¡å¯¬åº¦ï¼Œä¹Ÿæ˜¯å®‰å…¨ç‰†çš„ä½ç½®
        let MAX_LEVELS = 3; 
        
        // Unit Config
        const UNIT_TYPES = [
            { id: 0, name: 'basic', cost: 50, cd: 2000, color: '#fff' }, 
            { id: 1, name: 'tank', cost: 150, cd: 4000, color: '#ddd' }, 
            { id: 2, name: 'gross', cost: 300, cd: 6000, color: '#90CAF9' },
            { id: 3, name: 'titan', cost: 600, cd: 12000, color: '#B39DDB' } 
        ];

        let gameState = {
            isRunning: false,
            mode: 'NORMAL', // NORMAL or BOSS
            level: 1,
            playerHp: 1000,
            maxPlayerHp: 1000,
            enemyHp: 3000,
            maxEnemyHp: 3000,
            money: 0,
            maxMoney: 2000,
            score: 0,
            cats: [],
            enemies: [],
            particles: [],
            activeList: [],
            currentVocab: null,
            currentVocabIndex: -1, 
            deck: [], 
            difficulty: 1,
            unitCooldowns: [0, 0, 0, 0],
            nextSpeakTime: 0,
            wordStartTime: 0,
            bossInvincible: false
        };

        // --- Classes (Entity, Particle) ---
        class Entity {
            constructor(x, y, isEnemy, type) {
                this.x = x;
                this.y = y;
                this.isEnemy = isEnemy;
                this.type = type;
                this.width = 50;
                this.height = 50;
                this.state = 'walk';
                this.attackTimer = 0;
                this.knockbackVelocity = 0;
                this.flashTime = 0;
                this.frame = 0;
                
                this.hp = 100;
                this.maxHp = 100;
                this.dmg = 10;
                this.speed = 1;
                this.range = 10;
                this.attackSpeed = 60;
                
                this.applyTypeStats();
            }

            applyTypeStats() {
                if (!this.isEnemy) {
                    if (this.type === 'basic') {
                        this.hp = 150; this.maxHp = 150;
                        this.dmg = 20; this.speed = 2;
                        this.width = 40; this.height = 40;
                    } else if (this.type === 'tank') {
                        this.hp = 800; this.maxHp = 800;
                        this.dmg = 5; this.speed = 0.5;
                        this.width = 50; this.height = 80;
                    } else if (this.type === 'gross') {
                        this.hp = 250; this.maxHp = 250;
                        this.dmg = 80; this.speed = 0.8;
                        this.range = 150;
                        this.height = 100; this.width = 30;
                        this.attackSpeed = 90;
                    } else if (this.type === 'titan') {
                        this.hp = 1200; this.maxHp = 1200;
                        this.dmg = 200; this.speed = 0.7;
                        this.height = 110; this.width = 80;
                        this.range = 40;
                        this.attackSpeed = 100;
                    }
                } else {
                    if (this.type === 'doge') {
                        this.hp = 120; this.maxHp = 120;
                        this.dmg = 15; this.speed = 1.2;
                        this.color = '#DDAA77';
                        this.width = 40; this.height = 40;
                    } else if (this.type === 'pigge') {
                        this.hp = 800; this.maxHp = 800;
                        this.dmg = 40; this.speed = 0.5;
                        this.width = 70; this.height = 60;
                        this.color = '#F48FB1';
                        this.range = 20;
                    } else if (this.type === 'hippo') {
                        this.hp = 2000; this.maxHp = 2000;
                        this.dmg = 100; this.speed = 0.3;
                        this.width = 100; this.height = 70;
                        this.color = '#7986CB';
                    }
                }
            }

            update(dt, targets) {
                if (this.flashTime > 0) this.flashTime--;
                this.frame++;

                if (Math.abs(this.knockbackVelocity) > 0.1) {
                    this.x += this.knockbackVelocity;
                    this.knockbackVelocity *= 0.8;
                    // æ³¨æ„ï¼šé€™è£¡ä¸ returnï¼Œç¹¼çºŒåŸ·è¡Œä¸‹æ–¹çš„é‚Šç•Œæª¢æŸ¥ï¼Œé˜²æ­¢è¢«æ“Šé€€é€²ç‰†è£¡
                }

                let target = null;
                let minDist = Infinity;

                // æœå°‹æœ€è¿‘çš„æ•µäºº
                targets.forEach(t => {
                    let dist = this.isEnemy ? (this.x - (t.x + t.width)) : (t.x - (this.x + this.width));
                    // ä¿®æ­£ï¼šå°‡èƒŒå¾Œåµæ¸¬ç¯„åœå¾ -50 æ”¾å¯¬åˆ° -200
                    // é€™æ¨£å°±ç®—æ•µäººé‡ç–Šæˆ–ç¨å¾®ç©¿éæˆ‘æ–¹ï¼Œè²“å’ªä¹Ÿèƒ½åµæ¸¬åˆ°ä¸¦é€²è¡Œæ”»æ“Š
                    if (dist < minDist && dist >= -200) { 
                        minDist = dist;
                        target = t;
                    }
                });

                // å¦‚æœæ²’æœ‰å–®ä½ç›®æ¨™ï¼Œæª¢æŸ¥æ˜¯å¦æ”»æ“ŠåŸºåœ°
                const WALL_X = 100; // åŸå ¡ç‰†å£ä½ç½®
                
                if (!target) {
                    let baseDist;
                    if (this.isEnemy) {
                        // æ•µäººæ”»æ“Šæˆ‘æ–¹åŸºåœ°ï¼šè¨ˆç®—èˆ‡ç‰†å£ (X=100) çš„è·é›¢
                        baseDist = this.x - WALL_X;
                    } else {
                        // æˆ‘æ–¹æ”»æ“Šæ•µäººåŸºåœ°
                        baseDist = (GAME_WIDTH - WALL_X) - (this.x + this.width);
                    }
                    
                    if (baseDist <= this.range) target = "BASE";
                }

                if ((target && minDist <= this.range) || target === "BASE") {
                    this.state = 'attack';
                    if (this.attackTimer <= 0) {
                        this.attack(target);
                        this.attackTimer = this.attackSpeed;
                    } else {
                        this.attackTimer--;
                    }
                } else {
                    this.state = 'walk';
                    this.attackTimer = Math.max(0, this.attackTimer - 1);
                    
                    if (this.isEnemy) {
                        this.x -= this.speed;
                    } else {
                        this.x += this.speed;
                    }
                }

                // --- ç‰©ç†é™åˆ¶ (é˜²æ­¢ç©¿ç‰†çš„æ ¸å¿ƒä¿®æ­£) ---
                // ç„¡è«–ç‹€æ…‹ç‚ºä½•ï¼Œå¼·åˆ¶é™åˆ¶åº§æ¨™ï¼Œé˜²æ­¢å› ç‚ºæ“Šé€€æˆ–é€Ÿåº¦éå¿«ç©¿éåŸå ¡
                if (this.isEnemy) {
                    // æ•µäººä¸èƒ½è¶Šéæˆ‘æ–¹åŸå ¡ç‰†å£ (X < 100)
                    if (this.x < WALL_X) this.x = WALL_X;
                } else {
                    // æˆ‘æ–¹ä¸èƒ½è¶Šéæ•µäººåŸå ¡ç‰†å£
                    if (this.x + this.width > GAME_WIDTH - WALL_X) {
                        this.x = GAME_WIDTH - WALL_X - this.width;
                    }
                }
            }

            attack(target) {
                const particleX = this.isEnemy ? this.x : this.x + this.width;
                let actualDmg = this.dmg;
                
                if (target === "BASE") {
                    if (this.isEnemy) {
                          spawnParticle(particleX, this.y + this.height/2, 'pow');
                          gameState.playerHp -= actualDmg;
                          spawnParticle(50, GROUND_Y - 150, 'dmg', actualDmg); // é¡¯ç¤ºåœ¨åŸå ¡ä¸Šæ–¹
                    } else {
                        if (gameState.bossInvincible) {
                             spawnParticle(GAME_WIDTH - 70, GROUND_Y - 80, 'text', 0, "SHIELD!");
                        } else {
                             spawnParticle(particleX, this.y + this.height/2, 'pow');
                             gameState.enemyHp -= actualDmg;
                             spawnParticle(GAME_WIDTH - 50, GROUND_Y - 150, 'dmg', actualDmg); // é¡¯ç¤ºåœ¨åŸå ¡ä¸Šæ–¹
                        }
                    }
                } else {
                    spawnParticle(particleX, this.y + this.height/2, 'pow');
                    target.takeDamage(actualDmg);
                    spawnParticle(target.x + target.width/2, GROUND_Y - target.height - 20, 'dmg', actualDmg);

                    if(this.type === 'titan') {
                         gameState.enemies.forEach(e => {
                             if(Math.abs(e.x - target.x) < 80) {
                                 e.takeDamage(actualDmg);
                                 spawnParticle(e.x + e.width/2, GROUND_Y - e.height - 20, 'dmg', actualDmg);
                             }
                         });
                    }
                }
            }

            takeDamage(amount) {
                this.hp -= amount;
                this.flashTime = 5;
                if (this.hp <= 0) {
                    // Die
                } else {
                    if (Math.random() < 0.2) { 
                        this.knockbackVelocity = this.isEnemy ? 15 : -15;
                    }
                }
            }

            draw(ctx, scaleX, scaleY) {
                const drawX = this.x * scaleX;
                const drawY = (GROUND_Y - this.height) * scaleY;
                const drawW = this.width * scaleX;
                const drawH = this.height * scaleY;
                const cx = drawX + drawW/2;
                const cy = drawY + drawH/2;

                ctx.save();
                
                if (this.flashTime > 0) {
                    ctx.globalAlpha = 0.7; ctx.fillStyle = '#fff';
                } else {
                    ctx.fillStyle = this.color || '#fff';
                }

                if (!this.isEnemy) {
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    
                    if (this.type === 'basic') {
                        ctx.beginPath();
                        ctx.arc(cx, cy + 5*scaleY, drawW/2, 0, Math.PI*2);
                        ctx.fill(); ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(cx - 15*scaleX, cy - 10*scaleY);
                        ctx.lineTo(cx - 20*scaleX, cy - 25*scaleY);
                        ctx.lineTo(cx - 5*scaleX, cy - 15*scaleY);
                        ctx.fill(); ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(cx + 15*scaleX, cy - 10*scaleY);
                        ctx.lineTo(cx + 20*scaleX, cy - 25*scaleY);
                        ctx.lineTo(cx + 5*scaleX, cy - 15*scaleY);
                        ctx.fill(); ctx.stroke();
                        ctx.fillStyle = '#000';
                        ctx.beginPath();
                        ctx.arc(cx - 8*scaleX, cy, 2, 0, Math.PI*2);
                        ctx.arc(cx + 8*scaleX, cy, 2, 0, Math.PI*2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(cx, cy + 5*scaleY);
                        ctx.lineTo(cx - 3*scaleX, cy + 8*scaleY);
                        ctx.moveTo(cx, cy + 5*scaleY);
                        ctx.lineTo(cx + 3*scaleX, cy + 8*scaleY);
                        ctx.stroke();
                        ctx.fillStyle = '#fff';
                        const legOffset = Math.sin(this.frame * 0.2) * 5 * scaleX;
                        ctx.beginPath();
                        ctx.ellipse(cx - 10*scaleX + legOffset, drawY + drawH, 4*scaleX, 6*scaleY, 0, 0, Math.PI*2);
                        ctx.fill(); ctx.stroke();
                        ctx.beginPath();
                        ctx.ellipse(cx + 10*scaleX - legOffset, drawY + drawH, 4*scaleX, 6*scaleY, 0, 0, Math.PI*2);
                        ctx.fill(); ctx.stroke();

                    } else if (this.type === 'tank') {
                        ctx.fillRect(drawX, drawY, drawW, drawH);
                        ctx.strokeRect(drawX, drawY, drawW, drawH);
                        ctx.fillStyle = '#000';
                        ctx.beginPath();
                        ctx.arc(cx - 10*scaleX, drawY + 15*scaleY, 2, 0, Math.PI*2);
                        ctx.arc(cx + 10*scaleX, drawY + 15*scaleY, 2, 0, Math.PI*2);
                        ctx.fill();
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.moveTo(drawX, drawY);
                        ctx.lineTo(drawX + 10*scaleX, drawY - 10*scaleY);
                        ctx.lineTo(drawX + 20*scaleX, drawY);
                        ctx.fill(); ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(drawX + drawW, drawY);
                        ctx.lineTo(drawX + drawW - 10*scaleX, drawY - 10*scaleY);
                        ctx.lineTo(drawX + drawW - 20*scaleX, drawY);
                        ctx.fill(); ctx.stroke();
                        const legOffset = Math.sin(this.frame * 0.1) * 3 * scaleX;
                        ctx.fillRect(cx - 15*scaleX + legOffset, drawY + drawH - 5*scaleY, 10*scaleX, 8*scaleY);
                        ctx.fillRect(cx + 5*scaleX - legOffset, drawY + drawH - 5*scaleY, 10*scaleX, 8*scaleY);

                    } else if (this.type === 'gross') {
                        ctx.fillRect(cx - 10*scaleX, drawY, 20*scaleX, 30*scaleY);
                        ctx.strokeRect(cx - 10*scaleX, drawY, 20*scaleX, 30*scaleY);
                        const legSwing = Math.sin(this.frame * 0.1) * 10 * scaleX;
                        ctx.beginPath();
                        ctx.moveTo(cx - 5*scaleX, drawY + 30*scaleY);
                        ctx.lineTo(cx - 5*scaleX + legSwing, drawY + drawH);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(cx + 5*scaleX, drawY + 30*scaleY);
                        ctx.lineTo(cx + 5*scaleX - legSwing, drawY + drawH);
                        ctx.stroke();
                        ctx.fillStyle = '#000';
                        ctx.beginPath();
                        ctx.arc(cx - 4*scaleX, drawY + 10*scaleY, 1.5, 0, Math.PI*2);
                        ctx.arc(cx + 4*scaleX, drawY + 10*scaleY, 1.5, 0, Math.PI*2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(cx, drawY + 12*scaleY, 5*scaleX, 0, Math.PI);
                        ctx.stroke();

                    } else if (this.type === 'titan') {
                        ctx.beginPath();
                        ctx.moveTo(cx - 30*scaleX, drawY + 20*scaleY);
                        ctx.lineTo(cx + 30*scaleX, drawY + 20*scaleY);
                        ctx.lineTo(cx + 20*scaleX, drawY + 70*scaleY);
                        ctx.lineTo(cx - 20*scaleX, drawY + 70*scaleY);
                        ctx.closePath();
                        ctx.fill(); ctx.stroke();
                        ctx.beginPath();
                        ctx.arc(cx, drawY + 10*scaleY, 10*scaleX, 0, Math.PI*2);
                        ctx.fill(); ctx.stroke();
                        const armSwing = Math.sin(this.frame * 0.1) * 20 * scaleX;
                        ctx.beginPath();
                        ctx.moveTo(cx + 25*scaleX, drawY + 25*scaleY);
                        ctx.lineTo(cx + 40*scaleX, drawY + 60*scaleY + armSwing);
                        ctx.lineWidth = 8;
                        ctx.stroke();
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(cx - 15*scaleX, drawY + 70*scaleY);
                        ctx.lineTo(cx - 20*scaleX, drawY + drawH);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(cx + 15*scaleX, drawY + 70*scaleY);
                        ctx.lineTo(cx + 20*scaleX, drawY + drawH);
                        ctx.stroke();
                    }

                } else {
                      if (this.type === 'doge') {
                        ctx.fillStyle = this.color;
                        ctx.fillRect(drawX, drawY + 10*scaleY, drawW, drawH - 10*scaleY);
                        ctx.beginPath();
                        ctx.moveTo(drawX + 5*scaleX, drawY + 10*scaleY);
                        ctx.lineTo(drawX + 10*scaleX, drawY);
                        ctx.lineTo(drawX + 15*scaleX, drawY + 10*scaleY);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(drawX + 25*scaleX, drawY + 10*scaleY);
                        ctx.lineTo(drawX + 30*scaleX, drawY);
                        ctx.lineTo(drawX + 35*scaleX, drawY + 10*scaleY);
                        ctx.fill();
                        ctx.fillStyle = '#000';
                        ctx.fillRect(drawX + 5*scaleX, drawY + 20*scaleY, 5*scaleX, 5*scaleY);
                        ctx.fillRect(drawX + 25*scaleX, drawY + 20*scaleY, 5*scaleX, 5*scaleY);
                    } else {
                        ctx.fillStyle = this.color;
                        ctx.fillRect(drawX, drawY, drawW, drawH);
                    }
                }

                const hpPct = this.hp / this.maxHp;
                ctx.fillStyle = 'red';
                ctx.fillRect(drawX, drawY - 8*scaleY, drawW, 4*scaleY);
                ctx.fillStyle = '#0f0';
                ctx.fillRect(drawX, drawY - 8*scaleY, drawW * hpPct, 4*scaleY);

                ctx.restore();
            }
        }

        class Particle {
            constructor(x, y, type, val, text) {
                this.x = x; this.y = y;
                this.type = type;
                this.life = 60;
                this.val = val;
                this.text = text;
            }
            update() {
                this.life--;
                this.y -= 1.0;
            }
            draw(ctx, scaleX, scaleY) {
                const dx = this.x * scaleX;
                const dy = this.y * scaleY;
                ctx.save();
                ctx.globalAlpha = Math.max(0, this.life / 60);
                
                if (this.type === 'money') {
                    ctx.fillStyle = '#FFD700';
                    ctx.font = `bold ${24 * scaleY}px Arial`;
                    ctx.fillText(this.text, dx, dy);
                    ctx.strokeStyle = 'black';
                    ctx.lineWidth = 1;
                    ctx.strokeText(this.text, dx, dy);
                } else if (this.type === 'score') {
                    ctx.fillStyle = '#00E676';
                    ctx.font = `bold ${22 * scaleY}px Arial`;
                    ctx.fillText(this.text, dx, dy);
                } else if (this.type === 'dmg') {
                    ctx.fillStyle = 'red';
                    ctx.font = `bold ${20 * scaleY}px Arial`;
                    ctx.fillText("-" + Math.floor(this.val), dx, dy);
                } else if (this.type === 'pow') {
                    ctx.fillStyle = 'orange';
                    ctx.beginPath();
                    ctx.arc(dx, dy, 15*scaleX, 0, Math.PI*2);
                    ctx.fill();
                } else if (this.type === 'text') {
                    ctx.fillStyle = '#FFF';
                    ctx.font = `bold ${26 * scaleY}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText(this.text, dx, dy);
                    ctx.strokeStyle = '#FF5722';
                    ctx.lineWidth = 2;
                    ctx.strokeText(this.text, dx, dy);
                }
                ctx.restore();
            }
        }

        // --- Logic ---

        function tryBuyUnit(index) {
            if (!gameState.isRunning) return;
            const unit = UNIT_TYPES[index];
            const now = Date.now();
            if (gameState.money >= unit.cost && now >= gameState.unitCooldowns[index]) {
                gameState.money -= unit.cost;
                gameState.unitCooldowns[index] = now + unit.cd;
                
                // ä¿®æ­£å‡ºç”Ÿé»ï¼šè¨­ç‚º 70 (æ›´é è¿‘é–€å£)
                // é…åˆåŸå ¡ç‰†å£ X=100ï¼Œè²“å’ªå³å´æœƒæ˜¯ 110ï¼Œç¢ºä¿èˆ‡æ”»åŸæ•µäºº(X=100)é‡ç–Šï¼Œä¿è­‰è§¸ç™¼æ”»æ“Š
                const cat = new Entity(70, 0, false, unit.name);
                
                gameState.cats.push(cat);
                updateHUD();
                const btn = document.getElementById(`btn-${index+1}`);
                btn.classList.add('cooldown');
                btn.style.setProperty('--cd', unit.cd + 'ms');
                setTimeout(() => btn.classList.remove('cooldown'), unit.cd);
            }
        }

        function spawnEnemy() {
            if (!gameState.isRunning) return;
            const r = Math.random();
            let type = 'doge';
            const lvl = gameState.level;
            
            if (gameState.mode === 'BOSS') {
                if (r > 0.5) type = 'pigge';
                if (r > 0.85) type = 'hippo';
            } else {
                if (lvl === 1) {
                    if (r > 0.85) type = 'pigge'; 
                } else if (lvl === 2) {
                    if (r > 0.6) type = 'pigge';
                    if (r > 0.95) type = 'hippo';
                } else {
                    if (r > 0.4) type = 'pigge';
                    if (r > 0.8) type = 'hippo';
                }
            }

            // ä¿®æ­£æ•µäººå‡ºç”Ÿé»ï¼šå¾æ•µæ–¹åŸå ¡é–€å£å‡ºç”Ÿ
            const enemy = new Entity(GAME_WIDTH - BASE_WIDTH - 60, 0, true, type);
            gameState.enemies.push(enemy);

            let baseTime = 3000;
            if (lvl === 2) baseTime = 2200;
            if (lvl === 3 || gameState.mode === 'BOSS') baseTime = 1200;
            const nextTime = Math.max(800, baseTime - (gameState.difficulty * 50));
            if (gameState.difficulty < 15) gameState.difficulty += 0.1; 
            setTimeout(spawnEnemy, nextTime);
        }

        // ... (å…¶ä»–æ—¢æœ‰å‡½æ•¸: initGame, refillDeck, speakWord, manualSpeak, pickNewWord, updateWordsRemaining, updateWordDisplay, successWord, addMoney, spawnParticle, updateHUD, update, loop, controls, GAS logic...) ...
        // (å› å­—æ•¸é™åˆ¶ï¼Œé€™è£¡çœç•¥éƒ¨åˆ†æœªä¿®æ”¹çš„å‡½æ•¸ï¼Œä½†åœ¨å¯¦éš›æª”æ¡ˆä¸­è«‹ä¿ç•™)

        function initGame(level) {
            gameState.level = level;
            const unitVal = document.getElementById('unit-select').value;
            gameState.activeList = [];
            
            if (unitVal.startsWith('BOSS')) {
                gameState.mode = 'BOSS';
                MAX_LEVELS = 1;
                
                if (unitVal === 'BOSS_BASIC') {
                    for(let i=1; i<=12; i++) gameState.activeList = gameState.activeList.concat(UNIT_DATA[`U${i}`]);
                    document.getElementById('level-indicator').innerText = "åŸºç¤é­”ç‹åŸ (U1-12)";
                    gameState.enemyHp = 10000; gameState.maxEnemyHp = 10000;
                } else if (unitVal === 'BOSS_INTER') {
                    for(let i=13; i<=24; i++) gameState.activeList = gameState.activeList.concat(UNIT_DATA[`U${i}`]);
                    document.getElementById('level-indicator').innerText = "ä¸­ç´šé­”ç‹åŸ (U13-24)";
                    gameState.enemyHp = 15000; gameState.maxEnemyHp = 15000;
                } else if (unitVal === 'BOSS_ADV') {
                    for(let i=25; i<=36; i++) gameState.activeList = gameState.activeList.concat(UNIT_DATA[`U${i}`]);
                    document.getElementById('level-indicator').innerText = "é€²éšé­”ç‹åŸ (U25-36)";
                    gameState.enemyHp = 20000; gameState.maxEnemyHp = 20000;
                } else {
                    for(let i=1; i<=36; i++) gameState.activeList = gameState.activeList.concat(UNIT_DATA[`U${i}`]);
                    document.getElementById('level-indicator').innerText = "çµ‚æ¥µé­”ç‹åŸ (All)";
                    gameState.enemyHp = 30000; gameState.maxEnemyHp = 30000;
                }

                gameState.playerHp = 3000; gameState.maxPlayerHp = 3000;
                gameState.bossInvincible = true;
                document.getElementById('shield-indicator').style.display = 'block';
                document.getElementById('shield-indicator').innerText = "ğŸ›¡ï¸ ç„¡æ•µè­·ç›¾ (æ¶ˆé™¤å–®å­—ä»¥è§£é™¤)";

            } else {
                gameState.mode = 'NORMAL';
                MAX_LEVELS = 3;
                gameState.bossInvincible = false;
                document.getElementById('shield-indicator').style.display = 'none';
                
                if (UNIT_DATA[unitVal]) {
                    gameState.activeList = UNIT_DATA[unitVal];
                } else {
                    gameState.activeList = UNIT_DATA['U1']; 
                }
                
                gameState.playerHp = 1000 + (level * 200); 
                gameState.maxPlayerHp = gameState.playerHp;
                if (level === 1) { gameState.enemyHp = 2000; gameState.maxEnemyHp = 2000; }
                else if (level === 2) { gameState.enemyHp = 4000; gameState.maxEnemyHp = 4000; }
                else { gameState.enemyHp = 8000; gameState.maxEnemyHp = 8000; }
                
                document.getElementById('level-indicator').innerText = `Level ${level}/${MAX_LEVELS} - ${unitVal}`;
            }

            gameState.money = 200; 
            if (level === 1) gameState.score = 0; 
            gameState.cats = [];
            gameState.enemies = [];
            gameState.particles = [];
            gameState.difficulty = 1; 
            gameState.unitCooldowns = [0,0,0,0];
            gameState.nextSpeakTime = 0;
            gameState.wordStartTime = 0;
            
            refillDeck();
            updateHUD();
            pickNewWord();
            setTimeout(spawnEnemy, 3000);
            
            document.getElementById('answer-input').focus();
        }

        function refillDeck() {
            gameState.deck = Array.from({length: gameState.activeList.length}, (_, i) => i);
            spawnParticle(GAME_WIDTH/2, 50, 'text', 0, "é—œå¡é–‹å§‹!");
            updateWordsRemaining();
        }

        function speakWord(text) {
            if (!gameState.isRunning) return;
            if (!window.speechSynthesis) return;
            const btn = document.getElementById('speaker-btn');
            btn.classList.add('speaking');
            setTimeout(() => btn.classList.remove('speaking'), 1000);
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1.0; 
            window.speechSynthesis.speak(utterance);
        }

        function manualSpeak() {
             if (gameState.currentVocab) {
                 speakWord(gameState.currentVocab.en);
                 gameState.nextSpeakTime = Date.now() + 4000;
             }
        }

        function pickNewWord() {
            if (gameState.deck.length === 0) {
                if (gameState.mode === 'BOSS') {
                    if (gameState.bossInvincible) {
                        gameState.bossInvincible = false;
                        spawnParticle(GAME_WIDTH/2, 100, 'text', 0, "è­·ç›¾è§£é™¤!");
                        document.getElementById('shield-indicator').style.display = 'none';
                        document.getElementById('shield-indicator').innerText = "æ•µæ–¹åŸºåœ°è„†å¼±!";
                        gameState.enemyHp = Math.min(gameState.enemyHp, 5000); 
                    }
                    if (!gameState.bossInvincible) {
                         refillDeck();
                    }
                } else {
                    refillDeck(); 
                }
            }

            if (gameState.deck.length > 0) {
                const randIndex = Math.floor(Math.random() * gameState.deck.length);
                const vocabIndex = gameState.deck[randIndex];
                gameState.deck.splice(randIndex, 1);
                
                gameState.currentVocab = gameState.activeList[vocabIndex];
                gameState.currentVocabIndex = vocabIndex;
                gameState.wordStartTime = Date.now(); 
                gameState.nextSpeakTime = Date.now(); 
                
                const len = gameState.currentVocab.en.length;
                let reward = 100;
                if (len >= 5) reward = 200;
                if (len >= 7) reward = 300;
                gameState.currentReward = reward;

                document.getElementById('current-meaning').innerHTML = `${gameState.currentVocab.zh} <span class="english-hint">${gameState.currentVocab.en}</span>`;
                document.getElementById('reward-preview').textContent = `çå‹µ: $${reward}`;
            } else {
                gameState.currentVocab = { en: "ATTACK!", zh: "å…¨åŠ›æ”»æ“ŠåŸå ¡!" };
                document.getElementById('current-meaning').innerText = "å…¨åŠ›æ”»æ“ŠåŸå ¡!";
                document.getElementById('reward-preview').innerText = "";
                document.getElementById('target-word-display').innerHTML = "";
                document.getElementById('answer-input').placeholder = "å–®å­—å·²æ¸…ç©º!";
            }
            
            const input = document.getElementById('answer-input');
            input.value = "";
            input.focus();
            if (gameState.deck.length > 0) updateWordDisplay("");
            updateWordsRemaining();
        }
        
        function updateWordsRemaining() {
            document.getElementById('words-remaining').innerText = `å‰©é¤˜å–®å­—: ${gameState.deck.length + (gameState.currentVocab && gameState.deck.length > 0 ? 1 : 0)}`;
        }
        
        function updateWordDisplay(currentInput) {
            const container = document.getElementById('target-word-display');
            if (!gameState.currentVocab || gameState.deck.length === 0 && !gameState.bossInvincible && gameState.mode === 'BOSS') {
                container.innerHTML = "";
                return;
            }

            const target = gameState.currentVocab.en;
            container.innerHTML = "";
            
            for (let i = 0; i < target.length; i++) {
                const span = document.createElement('span');
                const char = target[i];
                if (i < currentInput.length) {
                    span.textContent = char;
                    span.className = 'char-correct';
                } else {
                    span.textContent = char;
                    span.className = 'char-pending';
                }
                span.style.marginRight = "5px";
                container.appendChild(span);
            }
        }

        // Answer Input Logic
        const answerInput = document.getElementById('answer-input'); // Added missing declaration

        answerInput.addEventListener('keydown', (e) => {
            if (e.key.length > 1 || e.ctrlKey || e.metaKey) return; 
            e.preventDefault(); 
            if (gameState.deck.length === 0 && gameState.mode === 'BOSS') return; 

            const targetWord = gameState.currentVocab.en;
            const currentVal = answerInput.value;
            const nextCharIndex = currentVal.length;
            
            if (nextCharIndex >= targetWord.length) return;
            
            const expectedChar = targetWord[nextCharIndex].toLowerCase();
            const typedChar = e.key.toLowerCase();
            
            if (typedChar === expectedChar) {
                answerInput.value += targetWord[nextCharIndex]; 
                updateWordDisplay(answerInput.value);
                if (answerInput.value.length === targetWord.length) {
                    successWord();
                }
            } else {
                answerInput.classList.add('shake');
                setTimeout(() => answerInput.classList.remove('shake'), 200);
            }
        });
        
        answerInput.addEventListener('keyup', (e) => {
            if (e.key === 'Backspace') {
                updateWordDisplay(answerInput.value);
            }
        });
        
        answerInput.addEventListener('paste', (e) => e.preventDefault());

        function successWord() {
            window.speechSynthesis.cancel();
            const timeTaken = Date.now() - gameState.wordStartTime;
            if (timeTaken > 10000) {
                gameState.deck.push(gameState.currentVocabIndex);
                spawnParticle(GAME_WIDTH/2, GAME_HEIGHT/2 - 80, 'text', 0, "âš ï¸ éœ€è¤‡ç¿’!");
            }
            addMoney(gameState.currentReward);
            gameState.score += gameState.currentReward;
            spawnParticle(GAME_WIDTH/2, GAME_HEIGHT/2, 'money', 0, `+$${gameState.currentReward}`);
            pickNewWord();
        }

        function addMoney(amount) {
            gameState.money = Math.min(gameState.maxMoney, gameState.money + amount);
            updateHUD();
        }

        function spawnParticle(x, y, type, val, text) {
            gameState.particles.push(new Particle(x, y, type, val, text));
        }

        function updateHUD() {
            document.getElementById('money-display').textContent = `$${gameState.money} / ${gameState.maxMoney}`;
            document.getElementById('score-display').textContent = `Score: ${gameState.score}`;
            document.getElementById('player-hp').style.width = (gameState.playerHp / gameState.maxPlayerHp * 100) + '%';
            document.getElementById('enemy-hp').style.width = (gameState.enemyHp / gameState.maxEnemyHp * 100) + '%';

            const now = Date.now();
            UNIT_TYPES.forEach((u, i) => {
                const btn = document.getElementById(`btn-${i+1}`);
                const onCd = now < gameState.unitCooldowns[i];
                if (gameState.money < u.cost || onCd) {
                    btn.classList.add('disabled');
                } else {
                    btn.classList.remove('disabled');
                }
            });
        }

        function update(dt) {
            if (gameState.playerHp <= 0) return endGame(false);
            if (gameState.enemyHp <= 0) return endGame(true);

            if (gameState.currentVocab && gameState.deck.length >= 0 && Date.now() > gameState.nextSpeakTime) {
                if (gameState.mode === 'BOSS' && gameState.deck.length === 0) {} 
                else {
                   speakWord(gameState.currentVocab.en);
                   gameState.nextSpeakTime = Date.now() + 4000;
                }
            }

            gameState.cats.forEach((cat, i) => {
                if (cat.hp <= 0) gameState.cats.splice(i, 1);
                else cat.update(dt, gameState.enemies);
            });
            gameState.enemies.forEach((enemy, i) => {
                if (enemy.hp <= 0) {
                    gameState.enemies.splice(i, 1);
                    gameState.score += 50;
                    spawnParticle(enemy.x, enemy.y - 20, 'score', 0, "+50");
                } else {
                    enemy.update(dt, gameState.cats);
                }
            });

            gameState.particles.forEach((p, i) => {
                p.update();
                if (p.life <= 0) gameState.particles.splice(i, 1);
            });

            if (Math.random() < 0.02) addMoney(1);
            updateHUD();
            if (document.activeElement !== answerInput) {
                answerInput.focus();
            }
        }

        // --- Drawing Castles ---
        function drawPlayerCastle(ctx, scaleX, scaleY) {
            const x = 0;
            const y = (GROUND_Y - 180) * scaleY;
            const w = BASE_WIDTH * scaleX;
            const h = 180 * scaleY;
            const groundY = GROUND_Y * scaleY;

            ctx.save();
            // Main structure
            ctx.fillStyle = '#6495ED'; // CornflowerBlue
            ctx.fillRect(x, y + 50*scaleY, w, h - 50*scaleY);
            
            // Battlements
            ctx.fillStyle = '#4169E1'; // RoyalBlue
            ctx.fillRect(x, y + 50*scaleY, w, 20*scaleY);
            ctx.fillRect(x + 10*scaleX, y + 30*scaleY, 20*scaleX, 20*scaleY);
            ctx.fillRect(x + 50*scaleX, y + 30*scaleY, 20*scaleX, 20*scaleY);
            ctx.fillRect(x + 90*scaleX, y + 30*scaleY, 10*scaleX, 20*scaleY);

            // Tall Tower
            ctx.fillStyle = '#87CEFA'; // LightSkyBlue
            ctx.fillRect(x + 30*scaleX, y, 40*scaleX, 100*scaleY);
            // Tower Roof
            ctx.beginPath();
            ctx.moveTo(x + 20*scaleX, y);
            ctx.lineTo(x + 50*scaleX, y - 40*scaleY);
            ctx.lineTo(x + 80*scaleX, y);
            ctx.fillStyle = '#0000CD'; // MediumBlue
            ctx.fill();

            // Door
            ctx.fillStyle = '#444';
            ctx.beginPath();
            ctx.arc(x + 50*scaleX, groundY, 30*scaleY, Math.PI, 0);
            ctx.fill();
            
            // Flag
            ctx.beginPath();
            ctx.moveTo(x + 50*scaleX, y - 40*scaleY);
            ctx.lineTo(x + 50*scaleX, y - 70*scaleY);
            ctx.strokeStyle = '#000';
            ctx.stroke();
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.moveTo(x + 50*scaleX, y - 70*scaleY);
            ctx.lineTo(x + 80*scaleX, y - 55*scaleY);
            ctx.lineTo(x + 50*scaleX, y - 40*scaleY);
            ctx.fill();

            ctx.restore();
        }

        function drawEnemyCastle(ctx, scaleX, scaleY) {
            const w = BASE_WIDTH * scaleX;
            const x = canvas.width - w;
            const y = (GROUND_Y - 200) * scaleY;
            const h = 200 * scaleY;
            const groundY = GROUND_Y * scaleY;

            ctx.save();
            // Main Body
            ctx.fillStyle = '#8B0000'; // DarkRed
            ctx.fillRect(x, y + 60*scaleY, w, h - 60*scaleY);

            // Spikes/Battlements
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.moveTo(x, y + 60*scaleY);
            ctx.lineTo(x + 20*scaleX, y + 20*scaleY);
            ctx.lineTo(x + 40*scaleX, y + 60*scaleY);
            ctx.lineTo(x + 60*scaleX, y + 20*scaleY);
            ctx.lineTo(x + 80*scaleX, y + 60*scaleY);
            ctx.lineTo(x + 100*scaleX, y + 20*scaleY);
            ctx.lineTo(x + w, y + 60*scaleY);
            ctx.fill();

            // Central Tower
            ctx.fillStyle = '#B22222'; // FireBrick
            ctx.fillRect(x + 20*scaleX, y + 40*scaleY, 60*scaleX, 120*scaleY);
            
            // Evil Eye / Window
            ctx.fillStyle = '#FF4500'; // OrangeRed
            ctx.beginPath();
            ctx.arc(x + 50*scaleX, y + 80*scaleY, 15*scaleX, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = '#FFFF00';
            ctx.beginPath();
            ctx.ellipse(x + 50*scaleX, y + 80*scaleY, 3*scaleX, 10*scaleY, 0, 0, Math.PI*2);
            ctx.fill();

            // Horns
            ctx.fillStyle = '#222';
            ctx.beginPath();
            ctx.moveTo(x + 20*scaleX, y + 40*scaleY);
            ctx.quadraticCurveTo(x + 10*scaleX, y, x - 10*scaleX, y - 20*scaleY);
            ctx.lineTo(x + 20*scaleX, y + 40*scaleY); // close roughly
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(x + 80*scaleX, y + 40*scaleY);
            ctx.quadraticCurveTo(x + 90*scaleX, y, x + 110*scaleX, y - 20*scaleY);
            ctx.lineTo(x + 80*scaleX, y + 40*scaleY);
            ctx.fill();

            // Door
            ctx.fillStyle = '#111';
            ctx.fillRect(x + 35*scaleX, groundY - 50*scaleY, 30*scaleX, 50*scaleY);

            // Shield Effect
            if (gameState.bossInvincible) {
                ctx.strokeStyle = 'cyan';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(x + w/2, groundY - 70*scaleY, 100*scaleX, 0, Math.PI*2);
                ctx.stroke();
                
                ctx.globalAlpha = 0.3;
                ctx.fillStyle = 'cyan';
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }

            ctx.restore();
        }

        function draw() {
            const scaleX = canvas.width / GAME_WIDTH;
            const scaleY = canvas.height / GAME_HEIGHT;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
            if (gameState.mode === 'BOSS') {
                grad.addColorStop(0, '#220000'); grad.addColorStop(1, '#550000'); 
            } else if (gameState.level === 1) {
                grad.addColorStop(0, '#87CEEB'); grad.addColorStop(1, '#dcdcdc');
            } else if (gameState.level === 2) {
                grad.addColorStop(0, '#FF9800'); grad.addColorStop(1, '#FFE0B2');
            } else {
                grad.addColorStop(0, '#311B92'); grad.addColorStop(1, '#7E57C2');
            }
            ctx.fillStyle = grad;
            ctx.fillRect(0,0, canvas.width, canvas.height);

            // Ground
            ctx.fillStyle = '#654321';
            ctx.fillRect(0, GROUND_Y * scaleY, canvas.width, 5 * scaleY);
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, (GROUND_Y + 5) * scaleY, canvas.width, (GAME_HEIGHT - GROUND_Y) * scaleY);

            // Draw Castles
            drawPlayerCastle(ctx, scaleX, scaleY);
            drawEnemyCastle(ctx, scaleX, scaleY);

            gameState.cats.forEach(c => c.draw(ctx, scaleX, scaleY));
            gameState.enemies.forEach(e => e.draw(ctx, scaleX, scaleY));
            gameState.particles.forEach(p => p.draw(ctx, scaleX, scaleY));
        }

        function loop(timestamp) {
            if (!gameState.isRunning) return;
            const dt = timestamp - lastTime;
            lastTime = timestamp;
            update(dt);
            draw();
            animationId = requestAnimationFrame(loop);
        }

        // ... (å‰©é¤˜çš„ Controls å’Œ GAS Leaderboard ä»£ç¢¼ä¿æŒä¸è®Š) ...
        
        function startGame(level) {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('level-complete-screen').style.display = 'none';
            document.getElementById('leaderboard-screen').style.display = 'none';
            
            gameState.isRunning = true;
            resizeCanvas();
            initGame(level);
            lastTime = performance.now();
            animationId = requestAnimationFrame(loop);
        }

        function nextLevel() {
            startGame(gameState.level + 1);
        }

        function endGame(victory) {
            gameState.isRunning = false;
            window.speechSynthesis.cancel(); 
            cancelAnimationFrame(animationId);
            
            if (victory && (gameState.mode !== 'BOSS' && gameState.level < MAX_LEVELS)) {
                // Next Stage
                const screen = document.getElementById('level-complete-screen');
                screen.style.display = 'flex';
                // Bonus score for clearing level
                gameState.score += 500;
            } else {
                // Game Over or Full Victory
                const screen = document.getElementById('game-over-screen');
                screen.style.display = 'flex';
                
                let title = victory ? "å®Œå…¨åˆ¶éœ¸!" : "æ•—åŒ—...";
                let scoreText = `ä½ çš„åˆ†æ•¸: ${gameState.score}`;
                
                document.getElementById('end-title').innerText = title;
                document.getElementById('end-score-text').innerText = scoreText;
                
                // Clear input
                document.getElementById('player-name-input').value = "";
                
                // Reset submit button state
                const btn = document.getElementById('submit-score-btn');
                btn.classList.remove('loading');
                btn.disabled = false;
                btn.innerText = "ç™»è¨˜ä¸¦å›ä¸»é¸å–®";
            }
        }
        
        async function fetchLeaderboard() {
             if (!GOOGLE_SCRIPT_URL) {
                 const localData = localStorage.getItem('xining_hero_ranks');
                 return localData ? JSON.parse(localData) : [];
             }
             try {
                 const response = await fetch(GOOGLE_SCRIPT_URL);
                 const data = await response.json();
                 return data;
             } catch (e) {
                 console.warn("Google Sheet é€£ç·šå¤±æ•—ï¼Œåˆ‡æ›è‡³æœ¬åœ°æ¨¡å¼", e);
                 const localData = localStorage.getItem('xining_hero_ranks');
                 return localData ? JSON.parse(localData) : [];
             }
        }

        async function submitScoreToGoogleSheet(name, score, date) {
             let ranks = JSON.parse(localStorage.getItem('xining_hero_ranks') || '[]');
             ranks.push({name, score, date});
             ranks.sort((a,b) => b.score - a.score);
             if (ranks.length > 20) ranks.length = 20;
             localStorage.setItem('xining_hero_ranks', JSON.stringify(ranks));

             if (!GOOGLE_SCRIPT_URL) return;

             try {
                 await fetch(GOOGLE_SCRIPT_URL, {
                     method: 'POST',
                     body: JSON.stringify({name, score, date}),
                     headers: { 'Content-Type': 'text/plain' }, 
                     redirect: 'follow'
                 });
             } catch (e) {
                 console.error("Google Sheet ä¸Šå‚³å¤±æ•—", e);
             }
        }

        async function submitScore() {
            const nameInput = document.getElementById('player-name-input');
            const name = nameInput.value.trim() || "ç„¡åè‹±é›„";
            const score = gameState.score;
            const date = new Date().toLocaleString("zh-TW", { 
                timeZone: "Asia/Taipei", 
                year: 'numeric', month: '2-digit', day: '2-digit'
            });

            const btn = document.getElementById('submit-score-btn');
            btn.innerText = "ä¸Šå‚³ä¸­...";
            btn.classList.add('loading');
            btn.disabled = true;

            await submitScoreToGoogleSheet(name, score, date);
            showLeaderboard();
        }

        function formatDateDisplay(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            if (isNaN(d.getTime())) return dateStr; 
            return d.toLocaleString("zh-TW", { 
                timeZone: "Asia/Taipei", 
                year: 'numeric', month: '2-digit', day: '2-digit'
            });
        }

        async function showLeaderboard() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('leaderboard-screen').style.display = 'flex';
            
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = "<tr><td colspan='4' class='loading-text'>è®€å–ä¸­...</td></tr>";
            
            try {
                const ranks = await fetchLeaderboard();
                tbody.innerHTML = "";
                if (!ranks || ranks.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='4'>æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°ï¼</td></tr>";
                    return;
                }
                ranks.forEach((r, index) => {
                    const tr = document.createElement('tr');
                    let rankClass = "";
                    let medal = "";
                    if (index === 0) { rankClass = "rank-1"; medal = "ğŸ¥‡ "; } 
                    else if (index === 1) { rankClass = "rank-2"; medal = "ğŸ¥ˆ "; } 
                    else if (index === 2) { rankClass = "rank-3"; medal = "ğŸ¥‰ "; }
                    tr.innerHTML = `<td class="${rankClass}">${medal}${index + 1}</td><td class="${rankClass}">${r.name}</td><td class="${rankClass}">${r.score}</td><td>${formatDateDisplay(r.date)}</td>`;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                tbody.innerHTML = "<tr><td colspan='4' class='error-text'>è®€å–å¤±æ•—ã€‚<br>è«‹æª¢æŸ¥ç¶²è·¯ã€‚</td></tr>";
            }
        }

        function showStartScreenFromLeaderboard() {
            document.getElementById('leaderboard-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
        }

        function resetGame() { 
            document.getElementById('game-over-screen').style.display = 'none';
            document.getElementById('start-screen').style.display = 'flex';
            gameState.activeList = [];
        }
        
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            if (container) {
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        
        window.addEventListener('keydown', (e) => {
            if (e.target.id === 'player-name-input') return;
            if (['1', '2', '3', '4'].includes(e.key)) {
                e.preventDefault(); 
                const idx = parseInt(e.key) - 1;
                tryBuyUnit(idx);
            }
        });
        
        setTimeout(resizeCanvas, 100);

    </script>
</body>
</html>
